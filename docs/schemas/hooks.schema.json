{
  "$schema": "http://json-schema.org/draft-07/schema#",
  "$id": "https://uaaps.github.io/uaaps_docs/schemas/hooks.schema.json",
  "title": "UAAPS Hooks Configuration",
  "description": "Schema for hooks/hooks.json — defines shell commands and LLM prompts triggered at agent lifecycle events.",
  "type": "object",
  "required": ["version", "hooks"],
  "additionalProperties": false,
  "properties": {
    "version": {
      "description": "Hooks config format version. Currently always 1.",
      "type": "integer",
      "const": 1
    },
    "hooks": {
      "description": "Map of lifecycle event name → array of hook groups.",
      "type": "object",
      "additionalProperties": false,
      "properties": {
        "pre-tool-use":       { "$ref": "#/definitions/hookGroupArray", "description": "Before tool execution. Supports blocking." },
        "permission-request": { "$ref": "#/definitions/hookGroupArray", "description": "When a permission dialog is shown. Supports blocking." },
        "post-tool-use":      { "$ref": "#/definitions/hookGroupArray", "description": "After tool execution. Feedback only." },
        "pre-prompt":         { "$ref": "#/definitions/hookGroupArray", "description": "Before a user prompt is processed. Supports blocking." },
        "session-start":      { "$ref": "#/definitions/hookGroupArray", "description": "When a new session begins. Can inject context." },
        "session-end":        { "$ref": "#/definitions/hookGroupArray", "description": "When a session terminates. Cleanup only." },
        "stop":               { "$ref": "#/definitions/hookGroupArray", "description": "When the agent finishes responding. Supports blocking." },
        "sub-agent-end":      { "$ref": "#/definitions/hookGroupArray", "description": "When a sub-agent finishes. Supports blocking." },
        "pre-compact":        { "$ref": "#/definitions/hookGroupArray", "description": "Before context compaction. Non-blocking." },
        "notification":       { "$ref": "#/definitions/hookGroupArray", "description": "System notification event. Non-blocking." }
      }
    }
  },
  "definitions": {
    "hookGroupArray": {
      "type": "array",
      "items": { "$ref": "#/definitions/hookGroup" }
    },
    "hookGroup": {
      "type": "object",
      "required": ["hooks"],
      "additionalProperties": false,
      "properties": {
        "matcher": {
          "description": "Regex pattern to filter by tool name. Omit to match all tools.",
          "type": "string"
        },
        "hooks": {
          "type": "array",
          "minItems": 1,
          "items": { "$ref": "#/definitions/hookEntry" }
        }
      }
    },
    "hookEntry": {
      "type": "object",
      "required": ["type"],
      "additionalProperties": false,
      "properties": {
        "type": {
          "description": "Hook execution strategy.",
          "type": "string",
          "enum": ["command", "prompt"]
        },
        "command": {
          "description": "Shell command to execute (required when type='command'). Receives event JSON on stdin. Exit code 2 blocks.",
          "type": "string"
        },
        "prompt": {
          "description": "LLM prompt to evaluate (required when type='prompt'). Use $ARGUMENTS to reference event input.",
          "type": "string"
        },
        "timeout": {
          "description": "Maximum execution time in seconds. Defaults to 30.",
          "type": "number",
          "minimum": 1,
          "maximum": 300
        }
      },
      "if": { "properties": { "type": { "const": "command" } } },
      "then": { "required": ["command"] },
      "else": { "required": ["prompt"] }
    }
  }
}
