{"config":{"lang":["en"],"separator":"[\\s\\-]+","pipeline":["stopWordFilter"],"fields":{"title":{"boost":1000.0},"text":{"boost":1.0},"tags":{"boost":1000000.0}}},"docs":[{"location":"","title":"UAAPS \u2014 Universal Agentic Artifact Package Specification","text":"<p>Write once. Deploy to any agent platform.</p> <p>UAAPS is the open standard for packaging AI agent artifacts \u2014 analogous to Docker for containers or npm for JavaScript packages. A single package works across Claude Code, GitHub Copilot, Cursor, OpenAI Codex, and any compliant platform.</p>"},{"location":"#why-uaaps","title":"Why UAAPS?","text":"Problem UAAPS Solution Skills written for Claude Code can't be used in Copilot Portable \u2014 one package, all platforms No lock file to reproduce agent behavior in CI Reproducible \u2014 <code>package.agent.lock</code> pins exact versions Multiple packages cause silent instruction conflicts Composable \u2014 namespaced skills prevent collisions No hooks for <code>pre-tool-use</code> or <code>permission-request</code> Lifecycle hooks \u2014 10 unified events No way to propagate skill updates across projects Registry \u2014 versioned distribution with the <code>aam</code> CLI No standard way to verify skills and hooks work correctly Testable \u2014 deterministic <code>tests/</code> + LLM-judged <code>evals/</code>"},{"location":"#quick-navigation","title":"Quick Navigation","text":"<ul> <li>Full Specification \u2014 Complete specification in a single document</li> <li>Introduction &amp; Principles \u2014 Design goals and core principles</li> <li>Package Manifest \u2014 <code>package.agent.json</code> schema reference</li> <li>Skills \u2014 The primary portable artifact</li> <li>Hooks \u2014 Lifecycle event handlers</li> <li>Dependency Resolution \u2014 Lock files and version resolution</li> <li>Compatibility Matrix \u2014 Platform support at a glance</li> <li>Migration Guides \u2014 Migrating from Claude Code, Cursor, or Copilot</li> <li>Implementers Guide \u2014 Getting started as a platform implementer</li> </ul>"},{"location":"#current-version","title":"Current Version","text":"<p>0.5.0-draft \u2014 See the Changelog for version history.</p>"},{"location":"#contributing","title":"Contributing","text":"<ol> <li>Read the specification</li> <li>Open an issue with feedback, edge cases, or missing scenarios</li> <li>Submit a PR with spec improvements or examples</li> <li>Test the Skills Concentrator</li> </ol>"},{"location":"changelog/","title":"Changelog","text":"<p>All notable changes to the UAAPS specification are documented here.</p> <p>The format follows Keep a Changelog.</p>"},{"location":"changelog/#050-draft-2026-02-22","title":"[0.5.0-draft] \u2014 2026-02-22","text":""},{"location":"changelog/#added","title":"Added","text":"<ul> <li>\u00a74 Skills: <code>tests/</code> directory structure for deterministic (assert) skill script testing</li> <li>\u00a78 Hooks: <code>tests/</code> directory structure with fixtures and deterministic hook testing</li> <li>\u00a72 Package Format: <code>evals/</code> directory expanded with full eval config, case format, and execution flow</li> <li>Evals system: LLM-judged integration tests via agent sandbox (<code>engine</code>, <code>judge</code>, <code>sandbox</code> config)</li> <li>Tests vs Evals comparison table clarifying the two-tier testing model</li> <li><code>aam test</code> CLI for deterministic assert tests (skills + hooks)</li> <li><code>aam eval</code> CLI for LLM-judged sandbox evaluations</li> </ul>"},{"location":"changelog/#040-draft-2026-02-19","title":"[0.4.0-draft] \u2014 2026-02-19","text":""},{"location":"changelog/#added_1","title":"Added","text":"<ul> <li>\u00a712 Packaging &amp; Distribution: archive format (<code>.aam</code>), scoped package names, dist-tags, portable bundles</li> <li>\u00a713 Dependency Resolution: lock file format, resolution algorithm, conflict handling, CI/CD patterns</li> <li>\u00a714 Package Signing &amp; Verification: Sigstore, GPG, registry attestation, verification policy</li> <li>\u00a715 Governance &amp; Policy Gates: client-side policy gates, approval workflows, audit log events</li> <li>\u00a75.5 Prompts: reusable parameterized prompt templates with variable interpolation</li> <li>MkDocs-based documentation structure replacing monolithic <code>SPECIFICATION.md</code></li> </ul>"},{"location":"changelog/#changed","title":"Changed","text":"<ul> <li>Merged <code>DESIGN.md</code> content into main specification</li> <li>Agent definitions restructured as two-file directories (<code>agent.yaml</code> + <code>system-prompt.md</code>)</li> </ul>"},{"location":"changelog/#030-2026-01-15","title":"[0.3.0] \u2014 2026-01-15","text":""},{"location":"changelog/#added_2","title":"Added","text":"<ul> <li>Initial hook event unification across Claude Code, Cursor, and Copilot</li> <li><code>AGENTS.md</code> designated as universal fallback instruction format</li> <li>Cross-platform compatibility matrix</li> </ul> <p>Older entries pending backfill.</p>"},{"location":"guides/implementers/","title":"Implementers Guide","text":"<p>Stub</p> <p>This guide is a placeholder. Content will be added in a future revision.</p>"},{"location":"guides/implementers/#overview","title":"Overview","text":"<p>This guide is for platform developers and tool authors who want to implement UAAPS support in their agent runtime, IDE, or toolchain.</p>"},{"location":"guides/implementers/#key-references","title":"Key References","text":"<ul> <li>Introduction &amp; Principles \u2014 Understand the design goals</li> <li>Package Manifest \u2014 <code>package.agent.json</code> schema</li> <li>Commands \u2014 Slash commands and parameterized templates</li> <li>Compatibility Matrix \u2014 Per-platform artifact support</li> <li>Migration Guides \u2014 Migrating existing plugin formats</li> <li>Validation Rules \u2014 Conformance requirements</li> </ul>"},{"location":"guides/implementers/#minimum-viable-implementation","title":"Minimum Viable Implementation","text":"<p>To claim UAAPS compliance, a platform must minimally support:</p> <ol> <li>Reading <code>package.agent.json</code> at the package root</li> <li>Discovering skills from the <code>skills/</code> directory (or declared <code>artifacts.skills</code>)</li> <li>Reading <code>SKILL.md</code> frontmatter for lazy-loading (<code>name</code> + <code>description</code>)</li> <li>Activating the full <code>SKILL.md</code> body on demand</li> </ol> <p>Support for commands, agents, hooks, and MCP servers is recommended but optional.</p>"},{"location":"schemas/","title":"UAAPS Schemas","text":"<p>JSON Schema (Draft-07) files for programmatic validation of all UAAPS-defined structured files.</p>"},{"location":"schemas/#files-that-require-a-schema","title":"Files That Require a Schema","text":"File / Pattern Schema Format Notes <code>package.agent.json</code> <code>package-manifest.schema.json</code> JSON Required in every package <code>package.agent.yaml</code> <code>package-manifest.schema.json</code> YAML Same schema; YAML variant <code>package.agent.lock</code> <code>package-lock.schema.json</code> JSON Auto-generated; commit to VCS <code>hooks/hooks.json</code> <code>hooks.schema.json</code> JSON Lifecycle event handlers <code>mcp/servers.json</code> <code>mcp-servers.schema.json</code> JSON MCP server configuration <code>agents/&lt;name&gt;/agent.yaml</code> <code>agent.schema.json</code> YAML Agent definition <code>agents/&lt;name&gt;/system-prompt.md</code> (frontmatter) <code>system-prompt-frontmatter.schema.json</code> YAML frontmatter System-prompt metadata block <code>skills/&lt;name&gt;/SKILL.md</code> (frontmatter) <code>skill-frontmatter.schema.json</code> YAML frontmatter Skill metadata block <code>rules/&lt;name&gt;/RULE.md</code> (frontmatter) <code>rule-frontmatter.schema.json</code> YAML frontmatter Rule metadata block <code>commands/&lt;name&gt;.md</code> (frontmatter) <code>command-frontmatter.schema.json</code> YAML frontmatter Command metadata block (including parameterized templates) <code>dist/&lt;name&gt;.bundle.aam</code> \u2192 <code>bundle.json</code> (internal) <code>bundle.schema.json</code> JSON Portable bundle manifest"},{"location":"schemas/#usage","title":"Usage","text":""},{"location":"schemas/#cli-validation-ajv","title":"CLI validation (ajv)","text":"<pre><code>npx ajv validate -s docs/schemas/package-manifest.schema.json -d package.agent.json\n</code></pre>"},{"location":"schemas/#python-jsonschema","title":"Python (jsonschema)","text":"<pre><code>import json, jsonschema, pathlib\n\nschema = json.loads(pathlib.Path(\"docs/schemas/package-manifest.schema.json\").read_text())\ninstance = json.loads(pathlib.Path(\"package.agent.json\").read_text())\njsonschema.validate(instance, schema)\n</code></pre>"},{"location":"schemas/#yaml-frontmatter","title":"YAML frontmatter","text":"<p>Extract the frontmatter block between <code>---</code> delimiters, parse it as YAML, then validate the resulting object against the relevant <code>*-frontmatter.schema.json</code>.</p> <pre><code>import yaml, jsonschema, pathlib\n\ndef load_frontmatter(md_path):\n    text = pathlib.Path(md_path).read_text()\n    parts = text.split(\"---\", 2)\n    return yaml.safe_load(parts[1]) if len(parts) &gt;= 3 else {}\n\nschema = json.loads(pathlib.Path(\"docs/schemas/skill-frontmatter.schema.json\").read_text())\ninstance = load_frontmatter(\"skills/my-skill/SKILL.md\")\njsonschema.validate(instance, schema)\n</code></pre>"},{"location":"schemas/#vs-code-integration","title":"VS Code integration","text":"<p>Add to <code>.vscode/settings.json</code> for in-editor validation: <pre><code>{\n  \"json.schemas\": [\n    {\n      \"fileMatch\": [\"**/package.agent.json\"],\n      \"url\": \"./docs/schemas/package-manifest.schema.json\"\n    },\n    {\n      \"fileMatch\": [\"**/package.agent.lock\"],\n      \"url\": \"./docs/schemas/package-lock.schema.json\"\n    },\n    {\n      \"fileMatch\": [\"**/hooks/hooks.json\"],\n      \"url\": \"./docs/schemas/hooks.schema.json\"\n    },\n    {\n      \"fileMatch\": [\"**/mcp/servers.json\"],\n      \"url\": \"./docs/schemas/mcp-servers.schema.json\"\n    },\n    {\n      \"fileMatch\": [\"**/agents/*/agent.yaml\"],\n      \"url\": \"./docs/schemas/agent.schema.json\"\n    },\n    {\n      \"fileMatch\": [\"**/bundle.json\"],\n      \"url\": \"./docs/schemas/bundle.schema.json\"\n    }\n  ]\n}\n</code></pre></p>"},{"location":"spec/00-introduction/","title":"Universal Agentic Artifact Package Specification (UAAPS)","text":"<p>Version: 0.5.0-draft Date: 2026-02-22 (revised) Purpose: Define a universal, portable package standard for AI agent artifacts \u2014 analogous to Docker for containers or npm for JavaScript packages. Goal: Write once, deploy to any agent platform. Simplify migration. Eliminate vendor lock-in.</p>"},{"location":"spec/00-introduction/#1-design-principles","title":"1. Design Principles","text":"Principle Description Portability A single package works across Claude Code, Cursor, Copilot, Codex, and any compliant platform. Progressive Disclosure Metadata loads first; full instructions load on activation; resources load on-demand. Convention over Configuration Standard directory names eliminate per-platform mapping; overrides are optional. Filesystem-First All artifacts are files on disk \u2014 no databases, no APIs required, no binary formats. Composability Packages can be installed together; namespacing prevents conflicts. Deterministic Resolution Lock files ensure reproducible installs across machines and CI. Backward Compatibility Existing Claude Code plugins and Cursor plugins work with minimal changes."},{"location":"spec/01-package-format/","title":"Package Format","text":""},{"location":"spec/01-package-format/#2-package-directory-structure","title":"2. Package Directory Structure","text":"<pre><code>package-name/\n\u251c\u2500\u2500 package.agent.json            # Package manifest (REQUIRED)\n\u251c\u2500\u2500 package.agent.lock            # Dependency lock file (auto-generated)\n\u251c\u2500\u2500 skills/                       # Agent Skills (optional)\n\u2502   \u2514\u2500\u2500 skill-name/\n\u2502       \u251c\u2500\u2500 SKILL.md              # Skill instructions (REQUIRED per skill)\n\u2502       \u251c\u2500\u2500 scripts/              # Executable scripts\n\u2502       \u251c\u2500\u2500 references/           # Documentation files\n\u2502       \u2514\u2500\u2500 assets/               # Templates, data, images\n\u251c\u2500\u2500 commands/                     # Slash commands (optional)\n\u2502   \u2514\u2500\u2500 command-name.md\n\u251c\u2500\u2500 agents/                       # Sub-agent definitions (optional)\n\u2502   \u2514\u2500\u2500 agent-name/\n\u2502       \u251c\u2500\u2500 agent.yaml            # Agent definition (name, skills, tools, params)\n\u2502       \u2514\u2500\u2500 system-prompt.md      # Agent system prompt\n\u251c\u2500\u2500 rules/                        # Project rules / instructions (optional)\n\u2502   \u2514\u2500\u2500 rule-name/\n\u2502       \u2514\u2500\u2500 RULE.md\n\u251c\u2500\u2500 hooks/                        # Lifecycle hooks (optional)\n\u2502   \u2514\u2500\u2500 hooks.json\n\u251c\u2500\u2500 mcp/                          # MCP server configs (optional)\n\u2502   \u2514\u2500\u2500 servers.json\n\u251c\u2500\u2500 evals/                        # LLM-judged evaluations (optional)\n\u2502   \u251c\u2500\u2500 eval-config.json          #   Eval runner configuration\n\u2502   \u251c\u2500\u2500 fixtures/                 #   Shared test fixtures\n\u2502   \u2502   \u2514\u2500\u2500 sample.pdf\n\u2502   \u2514\u2500\u2500 cases/                    #   Eval cases\n\u2502       \u251c\u2500\u2500 01-skill-e2e.yaml     #     Skill end-to-end eval\n\u2502       \u2514\u2500\u2500 02-hook-integration.yaml  # Hook integration eval\n\u251c\u2500\u2500 AGENTS.md                     # Universal agent instructions (optional)\n\u251c\u2500\u2500 README.md                     # Human documentation\n\u251c\u2500\u2500 CHANGELOG.md                  # Version history\n\u2514\u2500\u2500 LICENSE                       # License file\n</code></pre>"},{"location":"spec/01-package-format/#tests-vs-evals","title":"Tests vs Evals","text":"Concern <code>tests/</code> (per-artifact) <code>evals/</code> (top-level) Runner <code>assert</code> \u2014 subprocess + check output <code>eval</code> \u2014 LLM-judged in agent sandbox LLM calls 0 2+ per case (execute + judge) Agent needed No Yes \u2014 spawns real agent session Cost Free LLM API cost per case Speed Milliseconds Seconds to minutes CI suitability Every PR Nightly / pre-release What it tests Scripts produce correct output Skill works end-to-end via agent"},{"location":"spec/01-package-format/#evals-evals","title":"Evals \u2014 <code>evals/</code>","text":"<p>Evals are LLM-judged integration tests that verify skills and hooks work correctly when executed through a real agent runtime. Each eval case spins up a temporary workspace, launches an agent session, and uses an LLM-as-judge to assess the output.</p>"},{"location":"spec/01-package-format/#eval-config-evalseval-configjson","title":"Eval Config \u2014 <code>evals/eval-config.json</code>","text":"<pre><code>{\n  \"version\": 1,\n  \"engine\": \"claude-code\",\n  \"timeout\": 120,\n  \"judge\": \"claude-sonnet\",\n  \"sandbox\": {\n    \"network\": false,\n    \"writable-paths\": [\"src/\", \"output/\"]\n  },\n  \"env\": {\n    \"EVAL_MODE\": \"true\"\n  }\n}\n</code></pre> Field Type Required Description <code>version</code> <code>number</code> Yes Eval config format version. Currently <code>1</code>. <code>engine</code> <code>string</code> Yes Agent runtime to use: <code>\"claude-code\"</code>, <code>\"copilot\"</code>, <code>\"codex\"</code>, <code>\"cursor\"</code>. <code>timeout</code> <code>number</code> No Max seconds per eval case. Default <code>120</code>. <code>judge</code> <code>string</code> No Model used for LLM-as-judge assessment. Default: same as engine model. <code>sandbox.network</code> <code>bool</code> No Allow network access in sandbox. Default <code>false</code>. <code>sandbox.writable-paths</code> <code>string[]</code> No Directories the agent can write to. Default: temp workspace root. <code>env</code> <code>map&lt;str,str&gt;</code> No Environment variables injected into the sandbox."},{"location":"spec/01-package-format/#eval-case-format-evalscasesyaml","title":"Eval Case Format \u2014 <code>evals/cases/*.yaml</code>","text":"<pre><code>name: pdf-extraction-e2e\ndescription: Verify pdf-tools skill extracts text via agent session\ntarget: skill:pdf-tools\ninput:\n  prompt: \"Extract all text from fixtures/sample.pdf\"\n  files:\n    - fixtures/sample.pdf\n  workspace-files:\n    - src/empty.txt\nexpected:\n  contains:\n    - \"Hello, World\"\n    - \"Page 1\"\n  not-contains:\n    - \"ERROR\"\n  files-created:\n    - \"output/extracted.txt\"\njudge:\n  criteria: &gt;\n    Output must include all visible text from the PDF.\n    Formatting may differ but content must be complete.\n    The agent must not hallucinate content not in the PDF.\n</code></pre> <pre><code>name: hook-blocks-protected-write\ndescription: Verify pre-tool-use hook blocks agent from writing to /etc\ntarget: hook:pre-tool-use\ninput:\n  prompt: \"Write the word 'test' to /etc/config.txt\"\n  workspace-files:\n    - src/app.ts\nexpected:\n  not-contains:\n    - \"Successfully wrote\"\n  agent-blocked: true\njudge:\n  criteria: &gt;\n    The agent must be blocked by the pre-tool-use hook.\n    The agent should report that the write was denied.\n</code></pre> Field Type Required Description <code>name</code> <code>string</code> Yes Eval case identifier. <code>[a-z0-9-]</code>, max 64 chars. <code>description</code> <code>string</code> No Human-readable description. <code>target</code> <code>string</code> No What is being evaluated: <code>skill:&lt;name&gt;</code>, <code>hook:&lt;event&gt;</code>, or <code>agent:&lt;name&gt;</code>. <code>input.prompt</code> <code>string</code> Yes Prompt sent to the agent. <code>input.files</code> <code>string[]</code> No Fixture files copied into the sandbox (relative to <code>evals/</code>). <code>input.workspace-files</code> <code>string[]</code> No Additional files pre-created in the temp workspace. <code>expected.contains</code> <code>string[]</code> No Substrings that MUST appear in agent output. <code>expected.not-contains</code> <code>string[]</code> No Substrings that MUST NOT appear. <code>expected.files-created</code> <code>string[]</code> No Files the agent must create in the workspace. <code>expected.agent-blocked</code> <code>bool</code> No If <code>true</code>, expects the agent was blocked by a hook. <code>judge.criteria</code> <code>string</code> Yes Natural language pass/fail criteria for the LLM judge."},{"location":"spec/01-package-format/#eval-execution-flow","title":"Eval Execution Flow","text":"<pre><code>aam eval pdf-extraction-e2e\n\u2502\n\u251c\u2500 1. Create sandbox\n\u2502     mkdir /tmp/aam-eval-&lt;uuid&gt;/\n\u2502     Copy fixture files + workspace-files\n\u2502     Install package (skills, hooks, rules) into sandbox\n\u2502     Generate minimal package.agent.json\n\u2502\n\u251c\u2500 2. Launch agent session (headless)\n\u2502     claude -p \"&lt;prompt&gt;\" --workspace /tmp/aam-eval-&lt;uuid&gt;/\n\u2502     or: copilot-cli eval --prompt \"&lt;prompt&gt;\" --workspace /tmp/aam-eval-&lt;uuid&gt;/\n\u2502     or: codex --eval \"&lt;prompt&gt;\" --cwd /tmp/aam-eval-&lt;uuid&gt;/\n\u2502\n\u251c\u2500 3. Capture output\n\u2502     Agent stdout, stderr, files created, exit status\n\u2502\n\u251c\u2500 4. Deterministic checks (fast-fail)\n\u2502     contains / not-contains / files-created / agent-blocked\n\u2502\n\u251c\u2500 5. LLM-as-judge\n\u2502     Send output + judge.criteria to judge model\n\u2502     Verdict: PASS | FAIL + reason\n\u2502\n\u2514\u2500 6. Cleanup\n      rm -rf /tmp/aam-eval-&lt;uuid&gt;/\n</code></pre>"},{"location":"spec/01-package-format/#platform-eval-entry-points","title":"Platform Eval Entry Points","text":"Engine Headless command Status <code>claude-code</code> <code>claude -p \"prompt\" --workspace &lt;dir&gt;</code> \u2705 Available <code>codex</code> <code>codex --eval \"prompt\" --cwd &lt;dir&gt;</code> \u2705 Available <code>copilot</code> No public headless eval mode \u274c Gap <code>cursor</code> No headless mode \u274c Gap"},{"location":"spec/01-package-format/#running-evals","title":"Running Evals","text":"<pre><code>aam eval                              # Run all evals\naam eval pdf-extraction-e2e           # Run a specific eval case\naam eval --engine codex               # Override engine from config\naam eval --judge claude-opus          # Override judge model\naam eval --target skill:pdf-tools     # Run evals targeting a specific skill\naam eval --dry-run                    # Show what would run, no LLM calls\n</code></pre>"},{"location":"spec/01-package-format/#eval-report-evalsreportstimestampjson","title":"Eval Report \u2014 <code>evals/reports/&lt;timestamp&gt;.json</code>","text":"<p>Each eval run produces a JSON report capturing full provenance \u2014 which agent, which models, which results. Reports are written to <code>evals/reports/</code> and can be committed for historical tracking.</p> <pre><code>{\n  \"version\": 1,\n  \"id\": \"eval-run-2026-02-22T14-30-00Z\",\n  \"timestamp\": \"2026-02-22T14:30:00Z\",\n  \"duration_seconds\": 87,\n  \"config\": {\n    \"engine\": \"claude-code\",\n    \"engine_version\": \"1.4.2\",\n    \"judge\": \"claude-sonnet-4-20250514\",\n    \"timeout\": 120\n  },\n  \"agent\": {\n    \"runtime\": \"claude-code\",\n    \"runtime_version\": \"1.4.2\",\n    \"model\": \"claude-sonnet-4-20250514\",\n    \"model_provider\": \"anthropic\",\n    \"session_id\": \"sess_abc123\"\n  },\n  \"judge\": {\n    \"model\": \"claude-sonnet-4-20250514\",\n    \"model_provider\": \"anthropic\"\n  },\n  \"environment\": {\n    \"os\": \"linux\",\n    \"arch\": \"x86_64\",\n    \"aam_version\": \"0.5.0\",\n    \"node_version\": \"22.1.0\",\n    \"python_version\": \"3.12.3\"\n  },\n  \"package\": {\n    \"name\": \"@my-org/code-review\",\n    \"version\": \"1.0.0\"\n  },\n  \"summary\": {\n    \"total\": 5,\n    \"passed\": 4,\n    \"failed\": 1,\n    \"skipped\": 0,\n    \"pass_rate\": 0.80\n  },\n  \"cases\": [\n    {\n      \"name\": \"pdf-extraction-e2e\",\n      \"target\": \"skill:pdf-tools\",\n      \"verdict\": \"PASS\",\n      \"duration_seconds\": 18,\n      \"deterministic_checks\": {\n        \"contains\": \"PASS\",\n        \"not_contains\": \"PASS\",\n        \"files_created\": \"PASS\"\n      },\n      \"judge_verdict\": {\n        \"result\": \"PASS\",\n        \"reason\": \"Output contains all visible text from the PDF. No hallucinated content detected.\",\n        \"model\": \"claude-sonnet-4-20250514\"\n      },\n      \"agent_output_snippet\": \"Extracted text from sample.pdf:\\n\\nHello, World\\nPage 1...\"\n    },\n    {\n      \"name\": \"hook-blocks-protected-write\",\n      \"target\": \"hook:pre-tool-use\",\n      \"verdict\": \"FAIL\",\n      \"duration_seconds\": 12,\n      \"deterministic_checks\": {\n        \"not_contains\": \"PASS\",\n        \"agent_blocked\": \"FAIL\"\n      },\n      \"judge_verdict\": {\n        \"result\": \"FAIL\",\n        \"reason\": \"Agent was not blocked \u2014 hook script exited 0 instead of 2.\",\n        \"model\": \"claude-sonnet-4-20250514\"\n      },\n      \"agent_output_snippet\": \"I'll write the file...\",\n      \"error\": \"expected agent-blocked=true but hook exited 0\"\n    }\n  ]\n}\n</code></pre>"},{"location":"spec/01-package-format/#report-field-reference","title":"Report Field Reference","text":"Field Type Description <code>id</code> <code>string</code> Unique run identifier. <code>timestamp</code> <code>string</code> ISO 8601 run start time. <code>duration_seconds</code> <code>number</code> Total eval run wall time. <code>config.engine</code> <code>string</code> Agent runtime used (from config or <code>--engine</code> override). <code>config.judge</code> <code>string</code> Judge model used (from config or <code>--judge</code> override). <code>agent.runtime</code> <code>string</code> Actual agent runtime name. <code>agent.runtime_version</code> <code>string</code> Agent runtime version (e.g. Claude Code <code>1.4.2</code>). <code>agent.model</code> <code>string</code> LLM model the agent used for execution. <code>agent.model_provider</code> <code>string</code> Model provider (<code>anthropic</code>, <code>openai</code>, <code>google</code>, etc.). <code>agent.session_id</code> <code>string</code> Agent session ID for traceability. <code>judge.model</code> <code>string</code> LLM model used for judge assessment. <code>judge.model_provider</code> <code>string</code> Judge model provider. <code>environment</code> <code>object</code> OS, architecture, AAM version, language runtimes. <code>package</code> <code>object</code> Package name and version under evaluation. <code>summary</code> <code>object</code> Aggregated pass/fail/skip counts and pass rate. <code>cases[].verdict</code> <code>string</code> <code>\"PASS\"</code>, <code>\"FAIL\"</code>, or <code>\"SKIP\"</code>. <code>cases[].deterministic_checks</code> <code>object</code> Per-check pass/fail for substring and file assertions. <code>cases[].judge_verdict</code> <code>object</code> LLM judge result, reason, and model used. <code>cases[].agent_output_snippet</code> <code>string</code> Truncated agent output (first 500 chars). <code>cases[].error</code> <code>string</code> Error message if the case failed."},{"location":"spec/01-package-format/#comparing-eval-reports","title":"Comparing Eval Reports","text":"<pre><code>aam eval --report                     # Generate report (default: evals/reports/&lt;timestamp&gt;.json)\naam eval --report -o report.json      # Custom output path\naam eval diff &lt;report-a&gt; &lt;report-b&gt;   # Compare two reports side by side\n</code></pre> <p>Reports enable tracking eval pass rates across agent versions, model upgrades, and package changes \u2014 answering questions like \"did upgrading from <code>claude-sonnet</code> to <code>claude-opus</code> improve the pdf-tools eval?\"</p>"},{"location":"spec/02-manifest/","title":"Package Manifest","text":""},{"location":"spec/02-manifest/#3-package-manifest-packageagentjson","title":"3. Package Manifest \u2014 <code>package.agent.json</code>","text":"<p>The manifest is the single required file. It identifies the package and declares its contents.</p>"},{"location":"spec/02-manifest/#schema","title":"Schema","text":"<pre><code>{\n  // === REQUIRED ===\n  \"name\": \"my-package\",                        // [a-z0-9-] or @scope/name, max 64/130 chars\n  \"version\": \"1.0.0\",                          // SemVer\n\n  // === RECOMMENDED ===\n  \"description\": \"Brief description\",          // Max 1024 chars\n  \"author\": \"org-or-user\",\n  \"license\": \"Apache-2.0\",\n  \"repository\": \"https://github.com/org/repo\",\n  \"homepage\": \"https://docs.example.com\",      // Project homepage or docs URL\n\n  // === OPTIONAL ===\n  \"category\": \"Developer Tools\",               // Marketplace category\n  \"keywords\": [\"testing\", \"python\"],            // Discovery tags\n  \"engines\": {                                  // Platform compatibility\n    \"claude-code\": \"&gt;=1.0\",\n    \"cursor\": \"&gt;=2.2\",\n    \"copilot\": \"*\",\n    \"codex\": \"*\"\n  },\n\n  // === ARTIFACT DECLARATIONS (optional, explicit registry; auto-discovered if omitted) ===\n  // Declaring artifacts explicitly enables richer registry metadata and description per artifact.\n  \"artifacts\": {\n    \"skills\": [\n      { \"name\": \"pdf-tools\", \"path\": \"skills/pdf-tools/\", \"description\": \"Extract text from PDFs\" }\n    ],\n    \"agents\": [\n      { \"name\": \"code-auditor\", \"path\": \"agents/code-auditor/\", \"description\": \"Security audit agent\" }\n    ],\n    \"commands\": [\n      { \"name\": \"review\", \"path\": \"commands/review.md\", \"description\": \"Code review command\" },\n      { \"name\": \"audit-finding\", \"path\": \"commands/audit-finding.md\", \"description\": \"Finding template\" }\n    ]\n  },\n\n  // === DEPENDENCIES (optional) ===\n  \"dependencies\": {                             // Other agent packages required\n    \"code-review\": \"^1.0.0\",                   //   SemVer range\n    \"testing-utils\": \"&gt;=2.1.0 &lt;3.0.0\"\n  },\n  \"optionalDependencies\": {                     // Nice-to-have, install doesn't fail\n    \"ai-image-gen\": \"^1.0.0\"\n  },\n  \"peerDependencies\": {                         // Must be provided by host environment\n    \"eslint-rules\": \"&gt;=3.0.0\"\n  },\n  \"systemDependencies\": {                       // OS-level / runtime requirements\n    \"python\": \"&gt;=3.10\",\n    \"node\": \"&gt;=18\",\n    \"packages\": {                               //   Package manager installs\n      \"pip\": [\"pypdf\", \"pdfplumber&gt;=0.10\"],\n      \"npm\": [\"prettier\", \"eslint\"],\n      \"brew\": [\"graphviz\"],\n      \"apt\": [\"poppler-utils\"]\n    },\n    \"binaries\": [\"git\", \"docker\"],              //   Must exist on $PATH\n    \"mcp-servers\": [\"filesystem\"]              //   Required MCP servers\n  },\n\n  // === ENVIRONMENT &amp; SECRETS (optional) ===\n  \"env\": {                                      // Required environment variables\n    \"GITHUB_TOKEN\": { \"description\": \"Required for PR creation\", \"required\": true },\n    \"DEBUG_MODE\": { \"description\": \"Enable verbose logging\", \"required\": false, \"default\": \"false\" }\n  },\n\n  // === PERMISSIONS (optional) ===\n  \"permissions\": {                              // Requested agent capabilities\n    \"fs\": [\"read\", \"write\"],                    // Filesystem access scope\n    \"network\": [\"api.github.com\"],              // Allowed network hosts\n    \"shell\": false                              // Allow arbitrary shell execution\n  },\n\n  // === QUALITY (optional) ===\n  \"quality\": {\n    \"tests\": [\n      { \"name\": \"unit-tests\", \"command\": \"pytest tests/\", \"description\": \"Unit tests\" }\n    ],\n    \"evals\": [\n      {\n        \"name\": \"accuracy-eval\",\n        \"path\": \"evals/accuracy.yaml\",\n        \"description\": \"Measures accuracy against benchmark\",\n        \"metrics\": [\n          { \"name\": \"accuracy\", \"type\": \"percentage\" }\n        ]\n      }\n    ]\n  },\n\n  // === COMPONENT OVERRIDES (optional, defaults use convention) ===\n  \"skills\": \"./skills\",                         // Default: ./skills\n  \"commands\": \"./commands\",                     // Default: ./commands\n  \"agents\": \"./agents\",                         // Default: ./agents\n  \"rules\": \"./rules\",                           // Default: ./rules\n  \"hooks\": \"./hooks/hooks.json\",                // Default: ./hooks/hooks.json\n  \"mcp\": \"./mcp/servers.json\",                  // Default: ./mcp/servers.json\n\n  // === VENDOR EXTENSIONS (optional) ===\n  \"x-claude\": {\n    \"marketplace\": \"anthropics/skills\"\n  },\n  \"x-cursor\": {\n    \"category\": \"Developer Tools\"\n  }\n}\n</code></pre>"},{"location":"spec/02-manifest/#format-support","title":"Format Support","text":"<p>The canonical format is JSON (<code>package.agent.json</code>), but tools SHOULD also accept YAML (<code>package.agent.yaml</code>) for author convenience:</p> <pre><code># package.agent.yaml (equivalent to JSON, author-friendly)\nname: my-package           # or @scope/my-package for scoped\nversion: 1.0.0\ndescription: Brief description\nauthor: org-or-user\nlicense: Apache-2.0\nhomepage: https://docs.example.com\n\nskills: ./skills\ncommands: ./commands\nagents: ./agents\n\ndependencies:\n  code-review: \"^1.0.0\"\n\nx-claude:\n  marketplace: anthropics/skills\n\nx-cursor:\n  category: Developer Tools\n</code></pre> <p>Rules: - If both <code>.json</code> and <code>.yaml</code> exist, JSON takes precedence. - CLI tools (<code>aam install</code>, etc.) generate <code>package.agent.json</code> as the canonical output. - Lock files (<code>package.agent.lock</code>) are always JSON.</p>"},{"location":"spec/02-manifest/#vendor-mapping","title":"Vendor Mapping","text":"Manifest Field Claude Code (<code>plugin.json</code>) Cursor (<code>.cursor-plugin/plugin.json</code>) <code>name</code> <code>name</code> <code>name</code> <code>version</code> <code>version</code> <code>version</code> <code>description</code> <code>description</code> <code>description</code> <code>homepage</code> N/A N/A <code>skills</code> (auto-discovered in <code>skills/</code>) (auto-discovered in <code>skills/</code>) <code>commands</code> <code>commands</code> N/A (uses rules) <code>agents</code> <code>agents</code> N/A (uses rules/agents) <code>hooks</code> <code>hooks</code> path <code>.cursor/hooks.json</code> <code>mcp</code> <code>mcpServers</code> <code>mcp.json</code> <code>dependencies</code> N/A (no native equivalent) N/A (no native equivalent) <code>systemDependencies</code> Skill <code>compatibility</code> field N/A <code>quality</code> N/A N/A"},{"location":"spec/03-skills/","title":"Skills","text":""},{"location":"spec/03-skills/#4-skills-skillmd","title":"4. Skills \u2014 <code>SKILL.md</code>","text":"<p>Skills are the primary portable artifact \u2014 already standardized via the Agent Skills Open Standard (agentskills.io) and adopted by Claude Code, Cursor, Copilot, Codex, and others.</p>"},{"location":"spec/03-skills/#skillmd-format","title":"SKILL.md Format","text":"<pre><code>---\n# === REQUIRED ===\nname: skill-name                    # [a-z0-9-], max 64 chars\ndescription: &gt;                      # Max 1024 chars. WHAT it does + WHEN to use it.\n  Extract text and tables from PDF files, fill forms, merge documents.\n  Use when working with PDF files or when the user mentions PDFs.\n\n# === OPTIONAL (Open Standard) ===\nlicense: Apache-2.0\ncompatibility:                      # Only if skill has special requirements\n  requires:\n    - python&gt;=3.10\n    - pypdf\nmetadata:                           # Arbitrary key-value extensions\n  author: my-org\n  version: \"1.0\"\n\n# === OPTIONAL (Platform Extensions) ===\nallowed-tools: Read Grep Glob Bash  # Pre-approved tools (experimental)\ncontext: fork                       # Claude Code: run in isolated sub-agent\nagent: Explore                      # Claude Code: sub-agent config\ndisable-model-invocation: true      # Claude Code: user-only invocation\n---\n\n# Skill Title\n\n## Instructions\nStep-by-step guidance...\n\n## Examples\nConcrete usage examples...\n</code></pre>"},{"location":"spec/03-skills/#frontmatter-field-reference","title":"Frontmatter Field Reference","text":"Field Type Required Standard Description <code>name</code> <code>string</code> Yes agentskills.io <code>[a-z0-9-]</code>, max 64 chars <code>description</code> <code>string</code> Yes agentskills.io What + When. Max 1024 chars. <code>license</code> <code>string</code> No agentskills.io License identifier or filename <code>compatibility</code> <code>map</code> No agentskills.io Environment requirements <code>metadata</code> <code>map&lt;str,str&gt;</code> No agentskills.io Extension key-value pairs <code>allowed-tools</code> <code>string</code> No Extension Space-delimited tool whitelist <code>context</code> <code>string</code> No Claude ext. <code>\"fork\"</code> for isolated execution <code>agent</code> <code>string</code> No Claude ext. Sub-agent config name <code>disable-model-invocation</code> <code>bool</code> No Claude ext. Restrict to user-only invocation"},{"location":"spec/03-skills/#skill-directory","title":"Skill Directory","text":"<pre><code>skill-name/\n\u251c\u2500\u2500 SKILL.md         # REQUIRED\n\u251c\u2500\u2500 scripts/         # Executable code (Python, Bash, JS)\n\u251c\u2500\u2500 references/      # Additional documentation\n\u251c\u2500\u2500 assets/          # Templates, images, data\n\u251c\u2500\u2500 examples/        # Example inputs/outputs\n\u2514\u2500\u2500 tests/           # Skill tests (optional)\n    \u251c\u2500\u2500 test-config.json\n    \u2514\u2500\u2500 cases/\n        \u251c\u2500\u2500 01-basic.yaml\n        \u2514\u2500\u2500 02-edge-cases.yaml\n</code></pre>"},{"location":"spec/03-skills/#progressive-disclosure","title":"Progressive Disclosure","text":"Phase What Loads Token Cost 1. Metadata <code>name</code> + <code>description</code> from all skills ~50 tokens/skill 2. Activation Full <code>SKILL.md</code> body ~2,000\u20135,000 tokens 3. Execution <code>scripts/</code>, <code>references/</code>, <code>assets/</code> on-demand Variable"},{"location":"spec/03-skills/#skills-discovery-precedence","title":"Skills Discovery &amp; Precedence","text":"<p>Skills can exist at multiple scopes. The universal resolver follows this precedence:</p> Scope Location Precedence Namespaced? Managed / Enterprise Admin-deployed Highest No Project <code>./skills/</code> (in package or <code>.claude/skills/</code> or <code>.github/skills/</code>) Overrides personal No Personal <code>~/.claude/skills/</code> or <code>~/.github/skills/</code> or user profile Lowest non-plugin No Plugin / Package <code>&lt;package&gt;/skills/</code> Always namespaced Yes (<code>pkg:skill</code>) <p>Resolution rules: - When project and personal skills share the same <code>name</code>, project wins. - Plugin/package skills are always namespaced (<code>package-name:skill-name</code>) so they never conflict. - Enterprise/managed rules override all other scopes. - Monorepo support: skills in nested subdirectory <code>.claude/skills/</code> or <code>.github/skills/</code> are auto-discovered.</p> <p>Disputed precedence: ChatGPT investigation claimed enterprise &gt; personal &gt; project. Our investigation (verified against community guides) found enterprise &gt; project &gt; personal. The enterprise tier being highest is agreed; the project &gt; personal ordering is confirmed by Claude Code behavior where <code>.claude/skills/</code> in the project overrides <code>~/.claude/skills/</code> for same-named skills.</p>"},{"location":"spec/03-skills/#skill-testing","title":"Skill Testing","text":"<p>Skills MAY include a <code>tests/</code> directory with deterministic test cases that verify scripts behave correctly. These tests use the <code>assert</code> runner \u2014 no LLM calls, no agent sandbox, CI-safe.</p> <p>Eval-based testing (LLM-judged, agent sandbox) lives in the top-level <code>evals/</code> directory. See \u00a7 Evals in the package format spec.</p>"},{"location":"spec/03-skills/#test-config-teststest-configjson","title":"Test Config \u2014 <code>tests/test-config.json</code>","text":"<pre><code>{\n  \"version\": 1,\n  \"timeout\": 30,\n  \"env\": {\n    \"SKILL_TEST\": \"true\"\n  }\n}\n</code></pre> Field Type Required Description <code>version</code> <code>number</code> Yes Test config format version. Currently <code>1</code>. <code>timeout</code> <code>number</code> No Max seconds per test case. Default <code>30</code>. <code>env</code> <code>map&lt;str,str&gt;</code> No Environment variables injected during test runs."},{"location":"spec/03-skills/#test-case-format-testscasesyaml","title":"Test Case Format \u2014 <code>tests/cases/*.yaml</code>","text":"<pre><code>name: basic-pdf-extraction\ndescription: Verify script extracts text from a single-page PDF\ninput:\n  command: \"python scripts/extract.py tests/fixtures/sample.pdf\"\n  stdin: null\n  files:\n    - tests/fixtures/sample.pdf\nexpected:\n  exit-code: 0\n  stdout-contains:\n    - \"Hello, World\"\n    - \"Page 1\"\n  not-contains:\n    - \"ERROR\"\n    - \"Traceback\"\n</code></pre> Field Type Required Description <code>name</code> <code>string</code> Yes Test case identifier. <code>[a-z0-9-]</code>, max 64 chars. <code>description</code> <code>string</code> No Human-readable description of what is tested. <code>input.command</code> <code>string</code> Yes Shell command to execute (relative to skill root). <code>input.stdin</code> <code>string</code> No Data piped to stdin. <code>input.files</code> <code>string[]</code> No Fixture files required (relative to skill root). <code>expected.exit-code</code> <code>number</code> No Expected exit code. Default <code>0</code>. <code>expected.stdout-contains</code> <code>string[]</code> No Substrings that MUST appear in stdout. <code>expected.stderr-contains</code> <code>string[]</code> No Substrings that MUST appear in stderr. <code>expected.not-contains</code> <code>string[]</code> No Substrings that MUST NOT appear in combined output. <code>expected.stdout-json</code> <code>object</code> No JSON structure stdout MUST match (deep partial match)."},{"location":"spec/03-skills/#running-skill-tests","title":"Running Skill Tests","text":"<pre><code>aam test                             # Run all assert tests in current package\naam test skill-name                  # Run tests for a specific skill\naam test skill-name --case 01-basic  # Run a single test case\n</code></pre>"},{"location":"spec/03-skills/#platform-compatibility","title":"Platform Compatibility","text":"Platform Skill Location Status Claude Code <code>~/.claude/skills/</code>, <code>.claude/skills/</code>, plugin <code>skills/</code> \u2705 Full support Cursor Plugin <code>skills/</code>, imported as agent-decided rules \u2705 Supported (v2.2+) GitHub Copilot <code>.github/skills/</code>, <code>.claude/skills/</code> (also supported), user profile \u2705 Supported OpenAI Codex <code>~/.codex/skills/</code>, <code>.agents/skills/</code> \u2705 Supported Amp, Goose, OpenCode, Letta Various paths \u2705 Supported"},{"location":"spec/04-commands/","title":"Commands & Prompts","text":""},{"location":"spec/04-commands/#5-commands-slash-commands-reusable-templates","title":"5. Commands (Slash Commands &amp; Reusable Templates)","text":"<p>Commands are markdown prompt files that serve two roles:</p> <ol> <li>User-invoked \u2014 triggered by typing <code>/command-name</code>.</li> <li>Reusable templates \u2014 referenced by agents and skills via <code>{{variable}}</code> interpolation.</li> </ol> <p>A command with no <code>variables</code> is a simple slash command. A command with <code>variables</code> is a parameterized template that can also be referenced by agents and skills.</p>"},{"location":"spec/04-commands/#simple-command","title":"Simple Command","text":"<pre><code>---\nname: review\ndescription: Run a comprehensive code review on the current file\n---\n\nReview the current file for:\n1. Code organization and structure\n2. Error handling patterns\n3. Performance implications\n4. Security vulnerabilities\n5. Test coverage gaps\n\nProvide specific, actionable feedback with line references.\n</code></pre>"},{"location":"spec/04-commands/#parameterized-command-template","title":"Parameterized Command (Template)","text":"<pre><code>---\nname: audit-finding\ndescription: \"Structured command for documenting a single audit finding\"\nvariables:\n  - name: control_id\n    description: \"Control identifier\"\n    required: true\n  - name: severity\n    description: \"Finding severity level\"\n    required: true\n    enum: [critical, high, medium, low]\n    default: medium\n  - name: evidence\n    description: \"Supporting evidence\"\n    required: false\n    default: \"No evidence provided\"\n---\n\n# Audit Finding: {{control_id}}\n\n## Severity: {{severity}}\n\nAnalyze the following evidence and produce a structured finding:\n\n{{evidence}}\n</code></pre>"},{"location":"spec/04-commands/#frontmatter-fields","title":"Frontmatter Fields","text":"Field Type Required Description <code>name</code> <code>string</code> Yes Identifier, <code>[a-z0-9-]</code>, max 64 chars. <code>description</code> <code>string</code> Recommended Shown in command listings and help. <code>variables</code> <code>Variable[]</code> No Template variables with optional defaults and enums. <p>Each variable in the <code>variables</code> array has:</p> Field Type Required Description <code>name</code> <code>string</code> Yes Variable identifier used in <code>{{name}}</code> interpolation. <code>description</code> <code>string</code> No Human-readable description. <code>required</code> <code>boolean</code> No Whether the variable must be provided. Default: <code>false</code>. <code>enum</code> <code>string[]</code> No Allowed values. <code>default</code> <code>string</code> No Default value when not provided."},{"location":"spec/04-commands/#platform-mapping","title":"Platform Mapping","text":"Platform Native Support Location Invocation Claude Code \u2705 Yes <code>commands/</code> (.md files), <code>.claude/prompts/</code> <code>/plugin:command</code> Cursor \u2705 Prompts / \u26a0\ufe0f Commands via rules <code>.cursor/prompts/</code> No native <code>/command</code> from plugins GitHub Copilot \u2705 Yes <code>.github/prompts/&lt;name&gt;.prompt.md</code> Via prompt picker Codex \u26a0\ufe0f Via skills Skills with <code>disable-model-invocation</code> <code>$skill-name</code>"},{"location":"spec/04-commands/#migration-strategy","title":"Migration Strategy","text":"<p>For platforms without native command support, commands can be converted to skills with <code>disable-model-invocation: true</code> to achieve similar user-initiated behavior.</p>"},{"location":"spec/05-agents/","title":"Agents","text":""},{"location":"spec/05-agents/#6-agents-sub-agent-definitions","title":"6. Agents (Sub-agent Definitions)","text":"<p>Agents are specialized personas with domain expertise that can be selected automatically or manually. (Note: This is distinct from <code>AGENTS.md</code>, which provides project-wide instructions).</p> <p>Agents are defined as a directory containing two files, which provides richer structured configuration than a single markdown file.</p>"},{"location":"spec/05-agents/#directory-structure","title":"Directory Structure","text":"<pre><code>agents/\n\u2514\u2500\u2500 code-auditor/\n    \u251c\u2500\u2500 agent.yaml        # REQUIRED \u2014 structured agent definition\n    \u2514\u2500\u2500 system-prompt.md  # REQUIRED \u2014 the agent's full system prompt\n</code></pre>"},{"location":"spec/05-agents/#agentyaml-format","title":"<code>agent.yaml</code> Format","text":"<pre><code>name: code-auditor\ndescription: \"Security-focused code review agent\"\nversion: 1.0.0\n\nsystem_prompt: system-prompt.md    # Path to the system prompt file\n\n# Skills this agent uses (resolved from package or dependencies)\nskills:\n  - pdf-tools                      # from this package\n  - code-review                    # from dependency\n\n# Commands this agent references\ncommands:\n  - audit-finding                  # from this package\n\n# Tool access (platform-dependent)\ntools:\n  - file_read\n  - file_write\n  - shell\n\n# Behavioral parameters\nparameters:\n  temperature: 0.3\n  style: professional\n  output_format: markdown\n</code></pre>"},{"location":"spec/05-agents/#system-promptmd-format","title":"<code>system-prompt.md</code> Format","text":"<pre><code>---\ndescription: Security review specialist for vulnerability analysis\ncapabilities:\n  - OWASP Top 10 detection\n  - Dependency vulnerability scanning\n  - Secret detection\n  - Cryptographic implementation review\n---\n\nYou are a security review specialist. When analyzing code:\n\n1. Check for injection vulnerabilities\n2. Verify authentication patterns\n3. Review cryptographic implementations\n4. Scan for hardcoded secrets\n5. Assess dependency security\n\nProvide severity ratings (Critical/High/Medium/Low) with remediation.\n</code></pre>"},{"location":"spec/05-agents/#agentyaml-field-reference","title":"<code>agent.yaml</code> Field Reference","text":"Field Type Required Description <code>name</code> <code>string</code> Yes Agent identifier. <code>description</code> <code>string</code> Yes Role summary for automatic selection. <code>system_prompt</code> <code>string</code> Yes Relative path to <code>system-prompt.md</code>. <code>skills</code> <code>string[]</code> No Skills this agent activates. <code>commands</code> <code>string[]</code> No Commands (including parameterized templates) this agent uses. <code>tools</code> <code>string[]</code> No Tool whitelist (platform-dependent). <code>parameters</code> <code>map</code> No Behavioral parameters (temperature, style, etc.). <p>Legacy format: A single <code>agent-name.md</code> file (without a separate <code>agent.yaml</code>) is also accepted for backward compatibility. In this case the frontmatter fields from the <code>system-prompt.md</code> table below apply directly to the single file.</p>"},{"location":"spec/05-agents/#platform-mapping","title":"Platform Mapping","text":"Platform Native Support Migration Claude Code \u2705 Yes (<code>agents/</code> dir) Direct Cursor \u26a0\ufe0f No native <code>agents/</code> Convert <code>system-prompt.md</code> \u2192 RULE.md with <code>alwaysApply: true</code> GitHub Copilot \u2705 <code>.github/agents/*.agent.md</code> Convert to <code>.agent.md</code> Codex \u26a0\ufe0f Via skills Convert to skill"},{"location":"spec/06-rules/","title":"Rules","text":""},{"location":"spec/06-rules/#7-rules-project-rules-instructions","title":"7. Rules (Project Rules / Instructions)","text":"<p>Rules provide persistent context \u2014 coding standards, architecture conventions, and project-specific guidance.</p>"},{"location":"spec/06-rules/#universal-format-rulemd","title":"Universal Format: <code>RULE.md</code>","text":"<pre><code>---\ndescription: \"TypeScript coding standards for this project\"\nglobs: \"src/**/*.{ts,tsx}\"\nalwaysApply: false\n---\n\n# TypeScript Standards\n\n- Use strict mode\n- Prefer `const` over `let`\n- Use early returns\n- Named exports only\n- Co-locate tests as `*.test.ts`\n</code></pre>"},{"location":"spec/06-rules/#frontmatter-fields","title":"Frontmatter Fields","text":"Field Type Required Description <code>description</code> <code>string</code> Yes Purpose of rule. Used for agent auto-selection. <code>globs</code> <code>string</code> No File patterns for auto-attachment. <code>alwaysApply</code> <code>boolean</code> No Always include in context. Default: <code>false</code>."},{"location":"spec/06-rules/#platform-mapping","title":"Platform Mapping","text":"Platform Native Format Migration Claude Code <code>CLAUDE.md</code> (freeform) Copy content into <code>CLAUDE.md</code> Cursor <code>.mdc</code> / <code>RULE.md</code> in <code>.cursor/rules/</code> Copy to <code>.cursor/rules/</code> Codex <code>AGENTS.md</code> Copy into <code>AGENTS.md</code> sections Universal <code>AGENTS.md</code> (project root) Direct (supported everywhere)"},{"location":"spec/06-rules/#agentsmd-as-universal-fallback","title":"<code>AGENTS.md</code> as Universal Fallback","text":"<p><code>AGENTS.md</code> at the project root is the most portable instruction format \u2014 supported by Claude Code, Cursor, Codex, Copilot, Gemini CLI, Jules, Amp, and others. Every universal package SHOULD include an <code>AGENTS.md</code> for maximum compatibility.</p>"},{"location":"spec/07-hooks/","title":"Hooks","text":""},{"location":"spec/07-hooks/#8-hooks-lifecycle-event-handlers","title":"8. Hooks (Lifecycle Event Handlers)","text":"<p>Hooks execute shell commands at specific points in the agent lifecycle. They run outside the context window with zero token overhead.</p>"},{"location":"spec/07-hooks/#universal-hooksjson-format","title":"Universal <code>hooks.json</code> Format","text":"<pre><code>{\n  \"version\": 1,\n  \"hooks\": {\n    \"pre-tool-use\": [\n      {\n        \"matcher\": \"Write|Edit\",\n        \"hooks\": [{\n          \"type\": \"command\",\n          \"command\": \"bash ${PACKAGE_ROOT}/hooks/scripts/validate.sh\",\n          \"timeout\": 30\n        }]\n      }\n    ],\n    \"post-tool-use\": [\n      {\n        \"matcher\": \"Write|Edit\",\n        \"hooks\": [{\n          \"type\": \"command\",\n          \"command\": \"npx prettier --write ${file}\"\n        }]\n      }\n    ],\n    \"stop\": [\n      {\n        \"hooks\": [{\n          \"type\": \"prompt\",\n          \"prompt\": \"Check if all tasks are complete. Context: $ARGUMENTS\",\n          \"timeout\": 30\n        }]\n      }\n    ],\n    \"session-start\": [\n      {\n        \"hooks\": [{\n          \"type\": \"command\",\n          \"command\": \"bash ${PACKAGE_ROOT}/hooks/scripts/setup.sh\"\n        }]\n      }\n    ]\n  }\n}\n</code></pre>"},{"location":"spec/07-hooks/#unified-hook-events","title":"Unified Hook Events","text":"Universal Event Claude Code Cursor Copilot Can Block? Description <code>pre-tool-use</code> <code>PreToolUse</code> <code>beforeShellCommand</code> / <code>beforeMcpCall</code> <code>preToolUse</code> Yes Before tool execution <code>permission-request</code> <code>PermissionRequest</code> N/A N/A Yes Permission dialog shown <code>post-tool-use</code> <code>PostToolUse</code> <code>afterFileEdit</code> N/A Feedback After tool execution <code>pre-prompt</code> <code>UserPromptSubmit</code> <code>beforeSubmitPrompt</code> <code>userPromptSubmitted</code> Yes / Copilot: logging Before prompt processed <code>session-start</code> <code>SessionStart</code> N/A <code>sessionStart</code> Context inject New session begins <code>session-end</code> <code>SessionEnd</code> N/A <code>sessionEnd</code> Cleanup Session terminates <code>stop</code> <code>Stop</code> <code>stop</code> N/A Yes Agent finishes responding <code>sub-agent-end</code> <code>SubagentStop</code> N/A N/A Yes Sub-agent finishes <code>pre-compact</code> <code>PreCompact</code> N/A N/A No Before context compaction <code>notification</code> <code>Notification</code> N/A N/A No System notification <p>Copilot hook gaps: Copilot currently supports 4 hook events vs Claude Code's 10. The <code>stop</code>, <code>post-tool-use</code>, <code>permission-request</code>, <code>sub-agent-end</code>, <code>pre-compact</code>, and <code>notification</code> events have no Copilot equivalent. Community feature request #1157 tracks parity efforts.</p>"},{"location":"spec/07-hooks/#hook-types","title":"Hook Types","text":"Type Description Use Case <code>command</code> Execute a shell command Deterministic rules (lint, format, validate) <code>prompt</code> Query an LLM for context-aware decision Stop/continue decisions, complex validation"},{"location":"spec/07-hooks/#blocking-response-schema","title":"Blocking Response Schema","text":"<p>For hooks that support blocking (<code>pre-tool-use</code>, <code>permission-request</code>, <code>pre-prompt</code>, <code>stop</code>):</p> <pre><code>{\n  \"hookSpecificOutput\": {\n    \"hookEventName\": \"pre-tool-use\",\n    \"permissionDecision\": \"allow|deny|ask\",\n    \"permissionDecisionReason\": \"Reason shown to user or agent\",\n    \"updatedInput\": {}\n  }\n}\n</code></pre> <p>For <code>stop</code> / <code>sub-agent-end</code>:</p> <pre><code>{\n  \"decision\": \"block\",\n  \"reason\": \"Tests not yet executed\"\n}\n</code></pre>"},{"location":"spec/07-hooks/#exit-code-convention","title":"Exit Code Convention","text":"Code Behavior <code>0</code> Success. JSON on stdout parsed for structured control. <code>2</code> Blocking error. <code>stderr</code> fed back to agent. Other Non-blocking error. Logged only."},{"location":"spec/07-hooks/#hook-field-reference","title":"Hook Field Reference","text":"Field Type Required Description <code>matcher</code> <code>string</code> No Regex pattern for filtering by tool name. <code>hooks[].type</code> <code>string</code> Yes <code>\"command\"</code> or <code>\"prompt\"</code>. <code>hooks[].command</code> <code>string</code> For <code>command</code> Shell command. Receives JSON on stdin. <code>hooks[].prompt</code> <code>string</code> For <code>prompt</code> LLM prompt. <code>$ARGUMENTS</code> for input. <code>hooks[].timeout</code> <code>number</code> No Timeout in seconds."},{"location":"spec/07-hooks/#hooks-directory","title":"Hooks Directory","text":"<pre><code>hooks/\n\u251c\u2500\u2500 hooks.json           # REQUIRED \u2014 hook definitions\n\u251c\u2500\u2500 scripts/             # Shell scripts referenced by hooks\n\u2502   \u251c\u2500\u2500 validate.sh\n\u2502   \u251c\u2500\u2500 setup.sh\n\u2502   \u2514\u2500\u2500 format.sh\n\u2514\u2500\u2500 tests/               # Hook tests (optional)\n    \u251c\u2500\u2500 test-config.json\n    \u251c\u2500\u2500 fixtures/        # Simulated event payloads\n    \u2502   \u251c\u2500\u2500 pre-tool-use-write.json\n    \u2502   \u2514\u2500\u2500 stop-incomplete.json\n    \u2514\u2500\u2500 cases/\n        \u251c\u2500\u2500 01-pre-tool-block.yaml\n        \u2514\u2500\u2500 02-post-tool-format.yaml\n</code></pre>"},{"location":"spec/07-hooks/#hook-testing","title":"Hook Testing","text":"<p>Hooks MAY include a <code>tests/</code> directory with deterministic test cases that verify hook scripts behave correctly for simulated lifecycle events. These tests use the <code>assert</code> runner \u2014 no LLM calls, no agent sandbox, CI-safe.</p> <p>Eval-based testing (LLM-judged, agent sandbox) lives in the top-level <code>evals/</code> directory. See \u00a7 Evals in the package format spec.</p>"},{"location":"spec/07-hooks/#test-config-teststest-configjson","title":"Test Config \u2014 <code>tests/test-config.json</code>","text":"<pre><code>{\n  \"version\": 1,\n  \"timeout\": 30,\n  \"env\": {\n    \"HOOK_TEST\": \"true\",\n    \"PACKAGE_ROOT\": \".\"\n  }\n}\n</code></pre> Field Type Required Description <code>version</code> <code>number</code> Yes Test config format version. Currently <code>1</code>. <code>timeout</code> <code>number</code> No Max seconds per test case. Default <code>30</code>. <code>env</code> <code>map&lt;str,str&gt;</code> No Environment variables injected during test runs."},{"location":"spec/07-hooks/#fixture-payloads-testsfixturesjson","title":"Fixture Payloads \u2014 <code>tests/fixtures/*.json</code>","text":"<p>Fixtures simulate the JSON event that a hook receives on stdin during real execution.</p> <pre><code>{\n  \"hookEventName\": \"pre-tool-use\",\n  \"toolName\": \"Write\",\n  \"toolInput\": {\n    \"file_path\": \"/src/app.ts\",\n    \"content\": \"console.log('hello');\"\n  }\n}\n</code></pre>"},{"location":"spec/07-hooks/#test-case-format-testscasesyaml","title":"Test Case Format \u2014 <code>tests/cases/*.yaml</code>","text":"<pre><code>name: pre-tool-block-forbidden-path\ndescription: Verify pre-tool-use hook blocks writes to protected directories\nevent: pre-tool-use\nhook-index: 0\ninput:\n  fixture: fixtures/pre-tool-use-write.json\n  overrides:\n    toolInput.file_path: \"/etc/passwd\"\nexpected:\n  exit-code: 2\n  stderr-contains:\n    - \"blocked\"\n    - \"protected path\"\n  stdout-json:\n    hookSpecificOutput:\n      permissionDecision: deny\n</code></pre> <pre><code>name: post-tool-format-success\ndescription: Verify post-tool-use hook runs formatter without error\nevent: post-tool-use\nhook-index: 0\ninput:\n  fixture: fixtures/pre-tool-use-write.json\nexpected:\n  exit-code: 0\n  not-contains:\n    - \"ERROR\"\n</code></pre> Field Type Required Description <code>name</code> <code>string</code> Yes Test case identifier. <code>[a-z0-9-]</code>, max 64 chars. <code>description</code> <code>string</code> No Human-readable description of what is tested. <code>event</code> <code>string</code> Yes Hook event to test (e.g. <code>pre-tool-use</code>, <code>stop</code>). <code>hook-index</code> <code>number</code> No Index of the hook group in the event array. Default <code>0</code>. <code>input.fixture</code> <code>string</code> No Path to a fixture JSON file (relative to <code>tests/</code>). <code>input.overrides</code> <code>map</code> No Dot-path overrides applied on top of the fixture. <code>expected.exit-code</code> <code>number</code> No Expected exit code from the hook script. <code>expected.stderr-contains</code> <code>string[]</code> No Substrings that MUST appear in stderr. <code>expected.stdout-json</code> <code>object</code> No JSON structure that stdout MUST match (deep partial match). <code>expected.not-contains</code> <code>string[]</code> No Substrings that MUST NOT appear in combined output."},{"location":"spec/07-hooks/#running-hook-tests","title":"Running Hook Tests","text":"<pre><code>aam test --hooks                          # Run all hook tests in current package\naam test --hooks --case 01-pre-tool-block # Run a single hook test case\naam test --hooks --event pre-tool-use     # Run tests for a specific event only\n</code></pre>"},{"location":"spec/08-mcp/","title":"MCP Servers","text":""},{"location":"spec/08-mcp/#9-mcp-server-configuration","title":"9. MCP Server Configuration","text":"<p>Model Context Protocol servers extend agent capabilities with external tool access.</p>"},{"location":"spec/08-mcp/#universal-serversjson-format","title":"Universal <code>servers.json</code> Format","text":"<pre><code>{\n  \"servers\": {\n    \"my-service\": {\n      \"command\": \"node\",\n      \"args\": [\"${PACKAGE_ROOT}/mcp-server/index.js\"],\n      \"env\": {\n        \"API_KEY\": \"${API_KEY}\"\n      }\n    }\n  }\n}\n</code></pre>"},{"location":"spec/08-mcp/#platform-mapping","title":"Platform Mapping","text":"Platform Plugin Location Project Location Global Location Root Variable Claude Code <code>.mcp.json</code> at plugin root <code>.mcp.json</code> at project root <code>~/.claude/.mcp.json</code> <code>${CLAUDE_PLUGIN_ROOT}</code> Cursor <code>mcp.json</code> at plugin root <code>.cursor/mcp.json</code> <code>~/.cursor/mcp.json</code> Working dir relative Universal <code>mcp/servers.json</code> <code>mcp/servers.json</code> N/A <code>${PACKAGE_ROOT}</code> <p>Critical: Cursor plugin MCP uses <code>mcp.json</code> (no dot prefix, no <code>.cursor/</code> wrapper). Project/global MCP uses <code>.cursor/mcp.json</code>. Claude Code always uses <code>.mcp.json</code> (leading dot).</p>"},{"location":"spec/09-compatibility/","title":"Compatibility Matrix","text":""},{"location":"spec/09-compatibility/#10-cross-platform-compatibility-matrix","title":"10. Cross-Platform Compatibility Matrix","text":""},{"location":"spec/09-compatibility/#artifact-support-by-platform","title":"Artifact Support by Platform","text":"Artifact Claude Code Cursor Copilot Codex Standard Confidence Skills (SKILL.md) \u2705 Native \u2705 v2.2+ \u2705 <code>.github/skills/</code> \u2705 CLI+App agentskills.io Official Commands \u2705 Native \u26a0\ufe0f Via rules \u2705 <code>.prompt.md</code> \u26a0\ufe0f Via skills Package-defined Official Agents \u2705 Native (<code>agents/*.md</code>) \u26a0\ufe0f Via rules \u2705 <code>.agent.md</code> \u26a0\ufe0f Via skills Package-defined Official Rules / Instructions \u2705 <code>CLAUDE.md</code> \u2705 <code>.mdc</code>/<code>RULE.md</code> \u2705 <code>.instructions.md</code> \u26a0\ufe0f <code>AGENTS.md</code> Package-defined Official AGENTS.md \u2705 \u2705 \u2705 \u2705 agents.md Official Hooks \u2705 10 events \u2705 5 events \u2705 4 events \u274c Package-defined Official MCP Servers \u2705 Native \u2705 Native \u2705 CCA + VS Code \u26a0\ufe0f Limited MCP Protocol Official"},{"location":"spec/09-compatibility/#instruction-file-compatibility","title":"Instruction File Compatibility","text":"File Claude Code Cursor Copilot Codex Jules Confidence <code>AGENTS.md</code> \u2705 \u2705 \u2705 \u2705 \u2705 Official <code>CLAUDE.md</code> \u2705 \u2705* \u274c \u274c \u274c Official <code>GEMINI.md</code> \u274c \u2705* \u274c \u274c \u274c Community <code>.cursor/rules/*.mdc</code> \u274c \u2705 \u274c \u274c \u274c Official <code>.github/copilot-instructions.md</code> \u274c \u274c \u2705 \u274c \u274c Official <code>.github/instructions/*.instructions.md</code> \u274c \u274c \u2705 \u274c \u274c Official <code>.github/agents/*.agent.md</code> \u274c \u274c \u2705 \u274c \u274c Official <p>*Cursor reads <code>CLAUDE.md</code> and <code>GEMINI.md</code> as agent-specific instruction files alongside <code>AGENTS.md</code>.</p>"},{"location":"spec/09-compatibility/#github-copilot-artifact-types","title":"GitHub Copilot Artifact Types","text":"Artifact Location Format Description Repo instructions <code>.github/copilot-instructions.md</code> Plain Markdown Repository-wide guidance Path instructions <code>.github/instructions/*.instructions.md</code> YAML frontmatter (<code>applyTo</code> glob) + Markdown Path-scoped rules Custom agents <code>.github/agents/*.agent.md</code> Markdown Agent definitions (VS Code) Agent instructions <code>AGENTS.md</code> / <code>CLAUDE.md</code> / <code>GEMINI.md</code> Plain Markdown Agent-specific instructions"},{"location":"spec/09-compatibility/#path-instructions-example","title":"Path Instructions Example","text":"<pre><code>---\napplyTo: \"src/**/*.ts\"\n---\n\n# TypeScript Standards\n- Use strict mode\n- Prefer interfaces over type aliases\n</code></pre>"},{"location":"spec/10-migration/","title":"Migration Guides","text":""},{"location":"spec/10-migration/#11-migration-guides","title":"11. Migration Guides","text":""},{"location":"spec/10-migration/#from-claude-code-plugin-universal-package","title":"From Claude Code Plugin \u2192 Universal Package","text":"<pre><code>.claude-plugin/plugin.json    \u2192  package.agent.json\ncommands/*.md                 \u2192  commands/*.md (unchanged)\nagents/*.md                   \u2192  agents/&lt;name&gt;/system-prompt.md + agent.yaml (add structured def)\nskills/*/SKILL.md             \u2192  skills/*/SKILL.md (unchanged)\n.claude/prompts/*.md          \u2192  commands/*.md (add name field to frontmatter)\nhooks/hooks.json              \u2192  hooks/hooks.json (rename events)\n.mcp.json                     \u2192  mcp/servers.json (restructure)\nCLAUDE.md                     \u2192  AGENTS.md (rename)\n</code></pre>"},{"location":"spec/10-migration/#from-cursor-plugin-universal-package","title":"From Cursor Plugin \u2192 Universal Package","text":"<pre><code>.cursor-plugin/plugin.json    \u2192  package.agent.json\nskills/*/SKILL.md             \u2192  skills/*/SKILL.md (unchanged)\n.cursor/prompts/*.md          \u2192  commands/*.md (add name field to frontmatter)\nrules/*.mdc                   \u2192  rules/*/RULE.md (restructure frontmatter)\nmcp.json                      \u2192  mcp/servers.json (restructure)\n.cursor/hooks.json            \u2192  hooks/hooks.json (rename events)\nAGENTS.md                     \u2192  AGENTS.md (unchanged)\n</code></pre>"},{"location":"spec/10-migration/#from-github-copilot-universal-package","title":"From GitHub Copilot \u2192 Universal Package","text":"<pre><code>.github/copilot-instructions.md    \u2192  AGENTS.md (rename + restructure)\n.github/instructions/*.instructions.md  \u2192  rules/*/RULE.md (applyTo \u2192 globs)\n.github/agents/*.agent.md          \u2192  agents/*.md (remove .agent suffix)\nAGENTS.md                          \u2192  AGENTS.md (unchanged)\n</code></pre>"},{"location":"spec/10-migration/#instructionsmd-to-rulemd-frontmatter-mapping","title":"<code>.instructions.md</code> to <code>RULE.md</code> Frontmatter Mapping","text":"<pre><code># Copilot (.instructions.md)        # Universal (RULE.md)\n---                                  ---\napplyTo: \"src/**/*.ts\"              globs: \"src/**/*.ts\"\n---                                  alwaysApply: false\n                                     description: \"TypeScript standards\"\n                                     ---\n</code></pre>"},{"location":"spec/10-migration/#from-mdc-rule-rulemd","title":"From <code>.mdc</code> Rule \u2192 <code>RULE.md</code>","text":"<pre><code># .mdc (Cursor native)                    # RULE.md (Universal)\n---                                        ---\ndescription: React standards               description: React standards\nglobs: src/**/*.tsx                        globs: src/**/*.tsx\nalwaysApply: false                         alwaysApply: false\n---                                        ---\n# Content...                               # Content...\n</code></pre> <p>The formats are functionally identical. Only the file extension changes.</p>"},{"location":"spec/11-packaging/","title":"Packaging & Distribution","text":""},{"location":"spec/11-packaging/#12-packaging-distribution","title":"12. Packaging &amp; Distribution","text":""},{"location":"spec/11-packaging/#uaaps-registry","title":"UAAPS Registry","text":"<p>Packages are published to and installed from a UAAPS registry \u2014 an HTTP server implementing the UAAPS registry protocol. The official public registry is <code>registry.agentpkg.io</code>; organizations can self-host a private registry.</p> <pre><code># Install from the default registry\naam install @myorg/code-review\n\n# Install from a private registry\naam install @myorg/code-review --registry https://pkg.myorg.internal/aam\n\n# Publish to a registry\naam pkg publish --registry https://pkg.myorg.internal/aam\n</code></pre> <p>Registry configuration is managed in <code>~/.aam/config.yaml</code> or <code>.aam/config.yaml</code>:</p> <pre><code>registries:\n  default: https://registry.agentpkg.io\n  sources:\n    - name: myorg\n      url: https://pkg.myorg.internal/aam\n</code></pre> <p>Other distribution channels (Git marketplace, npm bridge, direct install, project-bundled) are supported by the <code>aam</code> CLI \u2014 see <code>aam_cli_new.md</code>.</p>"},{"location":"spec/11-packaging/#121-archive-distribution-format","title":"12.1 Archive Distribution Format","text":"<p>Packages are distributed as <code>.aam</code> archives (gzipped tar), providing a binary-safe, single-file distribution unit.</p> <pre><code>my-package-1.0.0.aam   # produced by: aam pkg pack\n</code></pre> <p>Archive constraints: - Maximum size: 50 MB - Must contain <code>package.agent.json</code> at root - No symlinks outside the package directory - No absolute paths - SHA-256 checksum stored in <code>package.agent.lock</code> post-install</p>"},{"location":"spec/11-packaging/#122-scoped-package-names","title":"12.2 Scoped Package Names","text":"<p>Following npm convention, packages support a <code>@scope/name</code> format for namespacing under an organization or author:</p> Format Example Use Case Unscoped <code>code-review</code> Community / public packages Scoped <code>@myorg/code-review</code> Organization packages <p>Name rules: - Unscoped: <code>[a-z0-9-]</code>, max 64 chars - Scope: <code>@[a-z0-9][a-z0-9_-]{0,63}</code> - Full scoped name: max 130 chars</p> <p>Filesystem mapping \u2014 the <code>@scope/name</code> format is converted using double-hyphen:</p> Package Name Filesystem Name <code>code-review</code> <code>code-review</code> <code>@myorg/code-review</code> <code>myorg--code-review</code> <p>The <code>--</code> separator is reversible and unambiguous because valid name segments cannot start with hyphens.</p>"},{"location":"spec/11-packaging/#123-dist-tags","title":"12.3 Dist-Tags","text":"<p>Dist-tags are named aliases for package versions, enabling installs like <code>aam install @org/agent@stable</code> or enterprise gates like <code>bank-approved</code>.</p>"},{"location":"spec/11-packaging/#default-tags","title":"Default Tags","text":"Tag Behavior <code>latest</code> Automatically set to the newest published version <code>stable</code> Opt-in; set manually via <code>aam dist-tag add</code>"},{"location":"spec/11-packaging/#custom-tags","title":"Custom Tags","text":"<p>Organizations can define arbitrary tags (e.g., <code>staging</code>, <code>bank-approved</code>, <code>qa-passed</code>).</p> <p>Tag rules: - Lowercase alphanumeric + hyphens only - Max 32 characters - Cannot be a valid SemVer string (prevents ambiguity)</p>"},{"location":"spec/11-packaging/#manifest-declaration-optional","title":"Manifest Declaration (optional)","text":"<pre><code>// package.agent.json\n{\n  \"name\": \"@myorg/agent\",\n  \"version\": \"1.2.0\",\n  \"dist-tags\": {\n    \"stable\": \"1.1.0\",     // Maintained by publisher\n    \"latest\": \"1.2.0\"\n  }\n}\n</code></pre>"},{"location":"spec/11-packaging/#124-portable-bundles","title":"12.4 Portable Bundles","text":"<p>A portable bundle is a self-contained, pre-compiled archive for a specific target platform. It contains artifacts already transformed to the platform's native format \u2014 no install-time resolution needed.</p> <p>Use case: Distributing packages via Slack, email, or air-gapped environments without a registry.</p> <pre><code>aam pkg build --target cursor\n# \u2192 dist/my-package-1.0.0-cursor.bundle.aam\n\naam pkg build --target copilot\n# \u2192 dist/my-package-1.0.0-copilot.bundle.aam\n\naam pkg build --target all\n# \u2192 one bundle per configured platform\n</code></pre> <p>Bundle structure (tar.gz internally):</p> <pre><code>my-package-1.0.0-cursor.bundle.aam\n\u251c\u2500\u2500 bundle.json               # Bundle manifest\n\u251c\u2500\u2500 .cursor/\n\u2502   \u251c\u2500\u2500 skills/...            # Pre-compiled platform artifacts\n\u2502   \u251c\u2500\u2500 rules/...\n\u2502   \u2514\u2500\u2500 commands/...\n\u2514\u2500\u2500 package.agent.json        # Original manifest for reference\n</code></pre> <p><code>bundle.json</code> schema:</p> <pre><code>{\n  \"format\": \"uaaps-bundle\",\n  \"version\": \"1.0\",\n  \"package\": \"@author/my-agent\",\n  \"package_version\": \"1.2.0\",\n  \"target\": \"cursor\",\n  \"built_at\": \"2026-02-19T14:30:00Z\",\n  \"checksum\": \"sha256:...\",\n  \"artifacts\": [\n    { \"type\": \"skill\", \"name\": \"my-skill\", \"path\": \".cursor/skills/author--my-skill/\" },\n    { \"type\": \"agent\", \"name\": \"my-agent\", \"path\": \".cursor/rules/agent-author--my-agent.mdc\" }\n  ]\n}\n</code></pre> <p>Installing from a bundle:</p> <pre><code>aam install ./dist/my-package-1.0.0-cursor.bundle.aam\n# Deploys immediately \u2014 no dependency resolution needed\n</code></pre>"},{"location":"spec/12-dependencies/","title":"Dependency Resolution","text":""},{"location":"spec/12-dependencies/#13-dependency-resolution","title":"13. Dependency Resolution","text":"<p>Dependency resolution is a core differentiator of UAAPS over raw vendor plugin systems. Like npm, pip, or Cargo, the package manager must resolve a directed acyclic graph (DAG) of requirements before installation.</p>"},{"location":"spec/12-dependencies/#131-dependency-types","title":"13.1 Dependency Types","text":"Type Manifest Key Required to Install? Semantics Direct <code>dependencies</code> Yes \u2014 install fails Other agent packages this package requires to function. Optional <code>optionalDependencies</code> No \u2014 install succeeds Enhances functionality if present. Graceful degradation if absent. Peer <code>peerDependencies</code> Yes \u2014 warn/fail Must be provided by the host project or another top-level install. Not auto-installed. System <code>systemDependencies</code> Yes \u2014 pre-flight check OS binaries, language runtimes, pip/npm packages, MCP servers."},{"location":"spec/12-dependencies/#132-version-constraint-syntax","title":"13.2 Version Constraint Syntax","text":"<p>UAAPS uses SemVer 2.0 with npm-style range operators:</p> Syntax Meaning Example <code>1.2.3</code> Exact version Only <code>1.2.3</code> <code>^1.2.3</code> Compatible with (<code>&gt;=1.2.3 &lt;2.0.0</code>) Minor + patch updates OK <code>~1.2.3</code> Approximately (<code>&gt;=1.2.3 &lt;1.3.0</code>) Patch updates only <code>&gt;=1.2.0</code> Minimum version <code>1.2.0</code> or higher <code>&gt;=1.0.0 &lt;3.0.0</code> Range Between <code>1.0.0</code> and <code>2.x.x</code> <code>*</code> Any version No constraint"},{"location":"spec/12-dependencies/#133-lock-file-packageagentlock","title":"13.3 Lock File \u2014 <code>package.agent.lock</code>","text":"<p>After resolution, the solver writes a deterministic lock file pinning exact versions:</p> <pre><code>{\n  \"lockVersion\": 1,\n  \"resolved\": {\n    \"code-review\": {\n      \"version\": \"1.3.2\",\n      \"source\": \"marketplace:anthropics/skills\",\n      \"integrity\": \"sha256-abc123...\",\n      \"dependencies\": {\n        \"git-utils\": \"1.0.1\"\n      }\n    },\n    \"testing-utils\": {\n      \"version\": \"2.4.0\",\n      \"source\": \"npm:@agentpkg/testing-utils\",\n      \"integrity\": \"sha256-def456...\"\n    },\n    \"git-utils\": {\n      \"version\": \"1.0.1\",\n      \"source\": \"marketplace:anthropics/skills\",\n      \"integrity\": \"sha256-ghi789...\"\n    }\n  },\n  \"systemChecks\": {\n    \"python\": \"3.12.1\",\n    \"binaries\": {\n      \"git\": \"/usr/bin/git\",\n      \"docker\": \"/usr/local/bin/docker\"\n    },\n    \"pip\": {\n      \"pypdf\": \"4.1.0\",\n      \"pdfplumber\": \"0.11.4\"\n    }\n  }\n}\n</code></pre> <p>Behavior: - If <code>package.agent.lock</code> exists, install uses locked versions (reproducible builds). - <code>aam install</code> reads the lock file; <code>aam update</code> regenerates it. - Lock files SHOULD be committed to version control for deterministic environments.</p>"},{"location":"spec/12-dependencies/#134-resolution-algorithm","title":"13.4 Resolution Algorithm","text":"<pre><code>1. Parse root package.agent.json\n2. Build initial requirement graph from dependencies + peerDependencies\n3. For each unresolved requirement:\n   a. Fetch available versions from source (marketplace, npm, local)\n   b. Filter by version constraint\n   c. Select highest compatible version (prefer stable over pre-release)\n   d. Recursively resolve transitive dependencies\n4. Detect conflicts:\n   a. If two packages require incompatible versions of the same dependency \u2192 ERROR\n   b. If peerDependency is unmet by root or any ancestor \u2192 WARN (or ERROR if strict)\n5. Flatten dependency tree (hoist where possible, like npm)\n6. Run system dependency pre-flight checks\n7. Write package.agent.lock\n8. Install resolved packages to install directory\n</code></pre>"},{"location":"spec/12-dependencies/#135-resolution-strategies","title":"13.5 Resolution Strategies","text":"Strategy Flag Behavior Default (none) Highest compatible version per constraint. Locked <code>--frozen</code> Only use versions from lock file. Fail if lock is stale. Minimal <code>--minimal</code> Lowest version satisfying each constraint (CI reproducibility). Latest <code>--latest</code> Ignore constraints, install latest of everything (dangerous). Dry-run <code>--dry-run</code> Resolve and display tree without installing."},{"location":"spec/12-dependencies/#136-package-dependencies-agent-to-agent","title":"13.6 Package Dependencies (Agent-to-Agent)","text":"<p>Agent packages can depend on other agent packages. This enables composition:</p> <pre><code>// package.agent.json for \"full-stack-review\"\n{\n  \"name\": \"full-stack-review\",\n  \"version\": \"1.0.0\",\n  \"dependencies\": {\n    \"code-review\": \"^1.0.0\",           // Reuse code review skills\n    \"security-scanning\": \"^2.0.0\",     // Reuse security agents\n    \"testing-utils\": \"^1.5.0\"          // Reuse test generation\n  }\n}\n</code></pre> <p>Transitive resolution: If <code>code-review@1.3.2</code> itself depends on <code>git-utils@^1.0.0</code>, the solver installs <code>git-utils</code> automatically.</p> <p>Namespace isolation: Each installed dependency's skills, commands, and agents are namespaced under <code>dependency-name:artifact-name</code> to prevent collisions.</p>"},{"location":"spec/12-dependencies/#137-system-dependencies","title":"13.7 System Dependencies","text":"<p>System dependencies are not installed by the package manager \u2014 they are verified via pre-flight checks.</p> <pre><code>\"systemDependencies\": {\n  // === Runtime requirements ===\n  \"python\": \"&gt;=3.10\",                  // Check: python3 --version\n  \"node\": \"&gt;=18\",                      // Check: node --version\n\n  // === Package manager installs ===\n  \"packages\": {\n    \"pip\": [\"pypdf&gt;=4.0\", \"pdfplumber\"],\n    \"npm\": [\"prettier@^3.0\", \"eslint\"],\n    \"brew\": [\"graphviz\", \"poppler\"],\n    \"apt\": [\"poppler-utils\", \"tesseract-ocr\"],\n    \"cargo\": [\"ripgrep\"]\n  },\n\n  // === Binary availability ===\n  \"binaries\": [\"git\", \"docker\", \"gh\"],  // Must exist on $PATH\n\n  // === MCP server requirements ===\n  \"mcp-servers\": [\"filesystem\", \"github\"]\n}\n</code></pre>"},{"location":"spec/12-dependencies/#pre-flight-check-flow","title":"Pre-flight Check Flow","text":"<pre><code>aam install my-package\n  \u2192 Checking system dependencies...\n  \u2713 python 3.12.1 (&gt;=3.10)\n  \u2713 node 20.11.0 (&gt;=18)\n  \u2713 git found at /usr/bin/git\n  \u2717 docker not found on $PATH\n  \u2713 pip: pypdf 4.1.0 installed\n  \u2717 pip: pdfplumber not installed\n\n  \u26a0 Missing system dependencies:\n    \u2022 docker: Install via https://docs.docker.com/get-docker/\n    \u2022 pdfplumber: Run `pip install pdfplumber`\n\n  Install package anyway? [y/N/auto-install]\n</code></pre>"},{"location":"spec/12-dependencies/#auto-install-behavior","title":"Auto-Install Behavior","text":"Package Manager Auto-install Flag <code>pip</code> \u2705 Supported <code>--install-system-deps</code> <code>npm</code> \u2705 Supported <code>--install-system-deps</code> <code>brew</code> / <code>apt</code> \u26a0\ufe0f Prompt only Requires <code>--install-system-deps --allow-sudo</code> <code>binaries</code> \u274c Never Manual install instructions provided <code>mcp-servers</code> \u2705 Via MCP registry <code>--install-system-deps</code>"},{"location":"spec/12-dependencies/#138-skill-level-dependencies","title":"13.8 Skill-Level Dependencies","text":"<p>Individual skills can declare their own dependencies in SKILL.md frontmatter, complementing the package-level manifest:</p> <pre><code>---\nname: pdf-processing\ndescription: Extract text and fill forms in PDFs.\ncompatibility:\n  requires:\n    - python&gt;=3.10\n    - pypdf&gt;=4.0\n    - pdfplumber\n  packages:                          # UAAPS extension\n    - code-review/git-utils          # Depends on another skill\n  optional:\n    - tesseract-ocr                  # For OCR, graceful degradation\n---\n</code></pre> <p>Resolution order: 1. Package-level <code>systemDependencies</code> checked first (covers most skills). 2. Skill-level <code>compatibility.requires</code> checked on activation (lazy check). 3. Skill-level <code>compatibility.packages</code> resolved transitively if referencing other skills.</p>"},{"location":"spec/12-dependencies/#139-conflict-resolution","title":"13.9 Conflict Resolution","text":""},{"location":"spec/12-dependencies/#version-conflicts","title":"Version Conflicts","text":"<p>When two packages require incompatible versions of the same dependency:</p> <pre><code>my-app\n\u251c\u2500\u2500 code-review@1.3.2\n\u2502   \u2514\u2500\u2500 git-utils@^1.0.0  \u2192  resolves to 1.0.5\n\u2514\u2500\u2500 deployment@2.0.0\n    \u2514\u2500\u2500 git-utils@^2.0.0  \u2192  resolves to 2.1.0   \u2190 CONFLICT\n</code></pre> <p>Resolution strategies:</p> Strategy Behavior When to Use Fail (default) Error, refuse to install Safety-first environments Duplicate Install both versions, isolate namespaces When skills don't share state Override Use <code>resolutions</code> field to force a version When you know compatibility holds Peer promote Lift to <code>peerDependencies</code>, let host decide Library packages"},{"location":"spec/12-dependencies/#resolution-overrides","title":"Resolution Overrides","text":"<pre><code>// package.agent.json\n{\n  \"resolutions\": {\n    \"git-utils\": \"2.1.0\"              // Force all transitive refs to this version\n  }\n}\n</code></pre>"},{"location":"spec/12-dependencies/#skill-name-conflicts","title":"Skill Name Conflicts","text":"<p>When two installed packages export skills with the same <code>name</code>:</p> <ul> <li>Skills are namespaced by package: <code>code-review:lint-check</code> vs <code>testing:lint-check</code>.</li> <li>If a skill is referenced without namespace, the closest scope wins (project &gt; personal &gt; plugin).</li> <li>Explicit disambiguation: <code>aam resolve skill lint-check</code> lists all matches.</li> </ul>"},{"location":"spec/12-dependencies/#1310-dependency-tree-commands","title":"13.10 Dependency Tree Commands","text":"Command Description <code>aam install</code> Install all dependencies from manifest (or lock file). <code>aam install &lt;pkg&gt;</code> Add a package and resolve. <code>aam update</code> Re-resolve all dependencies, update lock file. <code>aam update &lt;pkg&gt;</code> Update a single package within constraints. <code>aam tree</code> Display the full resolved dependency tree. <code>aam tree --depth=1</code> Show only direct dependencies. <code>aam why &lt;pkg&gt;</code> Explain why a package is installed (which parent requires it). <code>aam check</code> Verify all dependencies are installed and compatible. <code>aam check --system</code> Run system dependency pre-flight checks only. <code>aam outdated</code> List packages with newer versions available. <code>aam audit</code> Check dependencies for known security issues. <code>aam dedupe</code> Flatten tree, remove unnecessary duplicates. <code>aam prune</code> Remove installed packages not in the dependency tree."},{"location":"spec/12-dependencies/#1311-install-directory-layout","title":"13.11 Install Directory Layout","text":"<pre><code>.agent-packages/                       # Install root (analogous to node_modules/)\n\u251c\u2500\u2500 .lock                              # package.agent.lock (symlink or copy)\n\u251c\u2500\u2500 code-review/                       # Installed package\n\u2502   \u251c\u2500\u2500 package.agent.json\n\u2502   \u251c\u2500\u2500 skills/\n\u2502   \u2502   \u2514\u2500\u2500 lint-review/\n\u2502   \u2502       \u2514\u2500\u2500 SKILL.md\n\u2502   \u2514\u2500\u2500 commands/\n\u2502       \u2514\u2500\u2500 review.md\n\u251c\u2500\u2500 testing-utils/                     # Transitive dependency\n\u2502   \u251c\u2500\u2500 package.agent.json\n\u2502   \u2514\u2500\u2500 skills/\n\u2502       \u2514\u2500\u2500 test-gen/\n\u2502           \u2514\u2500\u2500 SKILL.md\n\u2514\u2500\u2500 git-utils/                         # Shared dependency (hoisted)\n    \u251c\u2500\u2500 package.agent.json\n    \u2514\u2500\u2500 skills/\n        \u2514\u2500\u2500 git-diff/\n            \u2514\u2500\u2500 SKILL.md\n</code></pre> <p>Hoisting: Like npm, shared dependencies are hoisted to the top level of <code>.agent-packages/</code> when version-compatible. This reduces duplication and simplifies skill discovery.</p>"},{"location":"spec/12-dependencies/#1312-dependency-resolution-in-cicd","title":"13.12 Dependency Resolution in CI/CD","text":"<p>For reproducible builds in CI environments:</p> <pre><code># .github/workflows/agent-check.yml\n- name: Install agent packages (frozen)\n  run: aam install --frozen\n\n- name: Verify system dependencies\n  run: aam check --system\n\n- name: Audit for security issues\n  run: aam audit --severity=high\n</code></pre> <p>The <code>--frozen</code> flag ensures CI uses exactly the versions from <code>package.agent.lock</code>, failing if the lock file is out of date.</p>"},{"location":"spec/13-signing/","title":"Signing & Verification","text":""},{"location":"spec/13-signing/#14-package-signing-verification","title":"14. Package Signing &amp; Verification","text":"<p>AAM supports multiple levels of integrity and authenticity verification for packages.</p>"},{"location":"spec/13-signing/#141-signing-methods","title":"14.1 Signing Methods","text":"Method Description When to Use Checksum SHA-256 hash of archive, always applied Automatic \u2014 all packages Sigstore Keyless, identity-based via OIDC Recommended for public packages GPG Traditional key-based signing Teams with existing GPG infrastructure Registry Attestation Server-side signatures Automated trust for verified registries"},{"location":"spec/13-signing/#142-signing-flow","title":"14.2 Signing Flow","text":"<pre><code>Author                          Registry                         User\n  \u2502  aam pkg publish --sign       \u2502                               \u2502\n  \u251c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u25ba\u2502                               \u2502\n  \u2502  1. Calculate SHA-256         \u2502                               \u2502\n  \u2502  2. Sign with Sigstore / GPG  \u2502  Verify signature             \u2502\n  \u2502  3. Upload archive+signature  \u2502  Store attestation            \u2502\n  \u2502                               \u2502         aam install pkg       \u2502\n  \u2502                               \u2502\u25c4\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2524\n  \u2502                               \u2502  1. Download archive          \u2502\n  \u2502                               \u251c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u25ba\u2502\n  \u2502                               \u2502  2. Verify checksum           \u2502\n  \u2502                               \u2502  3. Verify signature          \u2502\n  \u2502                               \u2502  4. Check trust policy        \u2502\n</code></pre>"},{"location":"spec/13-signing/#143-verification-policy","title":"14.3 Verification Policy","text":"<p>Configure in global <code>~/.aam/config.yaml</code> or project <code>.aam/config.yaml</code>:</p> <pre><code>security:\n  require_checksum: true           # Always enforced (non-configurable)\n  require_signature: false         # Require signed packages\n  trusted_identities:              # Sigstore OIDC identities to trust\n    - \"*@myorg.com\"\n  trusted_keys:                    # GPG key fingerprints to trust\n    - \"ABCD1234...\"\n  on_signature_failure: warn       # warn | error | ignore\n</code></pre>"},{"location":"spec/13-signing/#144-lock-file-integrity","title":"14.4 Lock File Integrity","text":"<p>The <code>package.agent.lock</code> stores SHA-256 hashes for every resolved package. On <code>--frozen</code> install, hashes are re-verified \u2014 any mismatch aborts with an error, preventing supply-chain tampering.</p>"},{"location":"spec/14-governance/","title":"Governance","text":""},{"location":"spec/14-governance/#15-governance-policy-gates","title":"15. Governance &amp; Policy Gates","text":"<p>Governance controls who can install what, and provides a tamper-evident record of actions. Policy gates are client-side (no server required); approval workflows require an HTTP registry.</p>"},{"location":"spec/14-governance/#151-client-side-policy-gates","title":"15.1 Client-Side Policy Gates","text":"<p>Configured in <code>config.yaml</code>, enforced by the CLI before any install or publish:</p> <pre><code>governance:\n  install_policy:\n    allowed_scopes: [\"@myorg\", \"@trusted-vendor\"] # only allow these scopes\n    require_signature: true                        # block unsigned packages\n    require_tag: \"stable\"                          # only install tagged versions\n    blocked_packages: [\"@sketchy/*\"]               # glob-matched block list\n  publish_policy:\n    require_signature: true                        # must sign before publishing\n</code></pre> Gate Trigger Effect <code>allowed_scopes</code> <code>aam install</code> Block packages outside listed scopes <code>require_signature</code> <code>aam install</code> Block unsigned packages <code>require_tag</code> <code>aam install</code> Only allow versions with a specific tag <code>blocked_packages</code> <code>aam install</code> Block specific packages (glob patterns) <code>require_signature</code> <code>aam pkg publish</code> Require signing before publish"},{"location":"spec/14-governance/#152-approval-workflows-http-registry","title":"15.2 Approval Workflows (HTTP Registry)","text":"<p>When <code>require_approval: true</code> is set and publishing to an HTTP registry:</p> <ol> <li><code>aam pkg publish</code> \u2192 uploads with <code>approval_status: pending</code></li> <li>Approvers receive notification</li> <li>Approver runs <code>aam approve @org/agent@1.2.0</code></li> <li>Only approved packages appear in search/install</li> </ol>"},{"location":"spec/14-governance/#153-audit-events","title":"15.3 Audit Events","text":"<p>Every registry mutation is logged immutably:</p> Event Description <code>package.publish</code> New version published <code>version.yank</code> Version marked as yanked <code>tag.set</code> Dist-tag added or updated <code>tag.remove</code> Dist-tag removed <code>version.approve</code> Version approved <code>version.reject</code> Version rejected <code>ownership.transfer</code> Package ownership transferred"},{"location":"spec/15-validation/","title":"Validation Rules","text":""},{"location":"spec/15-validation/#16-validation-rules","title":"16. Validation Rules","text":"Rule Constraint Package <code>name</code> <code>[a-z0-9-]</code>, max 64 chars Package <code>version</code> Valid SemVer 2.0 Skill <code>description</code> Max 1024 chars, must describe WHAT + WHEN SKILL.md body Recommended &lt; 5,000 tokens / 500 lines Frontmatter Valid YAML, no tabs Scripts Must be self-contained or document dependencies Hook commands Must handle JSON on stdin File references Forward slashes only, relative paths Dependency versions Valid SemVer range syntax (<code>^</code>, <code>~</code>, <code>&gt;=</code>, exact) Dependency graph Must be acyclic \u2014 circular dependencies are an error Peer dependencies Must be satisfied by root or ancestor package System dependencies Pre-flight check must pass (or explicit <code>--skip-checks</code>) Lock file integrity Hash must match on <code>--frozen</code> install Namespace uniqueness No two skills with same <code>name</code> within a single package Resolution overrides <code>resolutions</code> entries must reference packages in the tree"},{"location":"spec/16-security/","title":"Security","text":""},{"location":"spec/16-security/#17-security-considerations","title":"17. Security Considerations","text":"<ol> <li>Only install packages from trusted sources \u2014 skills can execute code and access the filesystem.</li> <li>Audit all scripts before enabling \u2014 look for network calls, file access, and unexpected operations.</li> <li>Use <code>allowed-tools</code> to restrict skill capabilities where possible.</li> <li>Hook commands run as the user \u2014 apply least-privilege principles.</li> <li>MCP servers should not expose secrets; use environment variable injection.</li> <li>Environment Variables: Packages must explicitly declare required environment variables in the <code>env</code> manifest field. Host platforms should prompt users securely for these values rather than storing them in plaintext.</li> <li>Permissions Model: Platforms should enforce the <code>permissions</code> manifest field, restricting filesystem, network, and shell access to declared scopes.</li> <li>Sandbox untrusted packages before production deployment.</li> <li>Verify lock file integrity \u2014 <code>package.agent.lock</code> hashes prevent supply-chain tampering.</li> <li>Run <code>aam audit</code> regularly to check dependencies for known vulnerabilities.</li> <li>System dependency auto-install never uses <code>sudo</code> without explicit <code>--allow-sudo</code> flag.</li> <li>Transitive dependencies should be audited \u2014 <code>aam tree</code> reveals the full graph.</li> </ol>"},{"location":"spec/17-glossary/","title":"Glossary","text":""},{"location":"spec/17-glossary/#18-glossary","title":"18. Glossary","text":"Term Definition Command A markdown file triggered by user typing <code>/name</code> or referenced as a parameterized template with <code>{{variable}}</code> interpolation. User or agent-invoked. Skill A folder with <code>SKILL.md</code> that teaches an agent a specific capability. Model-invoked. Agent A specialized persona definition with <code>agent.yaml</code> + <code>system-prompt.md</code>. Model or user-invoked. Rule Persistent context (coding standards, conventions). Applied by scope rules. Hook A shell command triggered by a lifecycle event. Always executed, zero token cost. MCP Server An external tool server using the Model Context Protocol. AGENTS.md Universal, freeform instruction file for any agent. Progressive Disclosure Loading strategy: metadata \u2192 instructions \u2192 resources, on-demand. Dependency Another agent package required for this package to function. Peer Dependency A package that must be provided by the host environment, not auto-installed. Optional Dependency A package that enhances functionality but isn't required. System Dependency An OS binary, runtime, or package-manager package required on the host. Lock File <code>package.agent.lock</code> \u2014 pins exact resolved versions for reproducible installs. Hoisting Flattening shared dependencies to the top of the install tree to reduce duplication. Resolution Override A <code>resolutions</code> entry that forces a specific version for a transitive dependency. Pre-flight Check Verification that system dependencies exist before package installation. SemVer Semantic Versioning 2.0 \u2014 <code>MAJOR.MINOR.PATCH</code> with defined compatibility rules. DAG Directed Acyclic Graph \u2014 the dependency tree structure. Cycles are forbidden. Permissions Declared scopes (fs, network, shell) that restrict what a package can do. Env Environment variables and secrets required by the package to function. Scope The <code>@org</code> namespace prefix in <code>@org/package-name</code> for organizational grouping. Archive A <code>.aam</code> gzipped tar file containing a distributable package. Bundle A pre-compiled, platform-specific archive requiring no install-time resolution. Dist-tag A named alias for a specific package version (e.g., <code>stable</code>, <code>bank-approved</code>). Policy Gate A client-side governance rule enforced before install or publish operations."},{"location":"spec/appendix/","title":"Appendix","text":""},{"location":"spec/appendix/#appendix-confidence-legend","title":"Appendix: Confidence Legend","text":"Level Meaning Example Official Verified against vendor documentation Hook event names, manifest schema Community Confirmed by multiple community sources Pseudo-XML rule structure, Cursor RULE.md folders Inferred Derived from behavior or early previews Parallel agent counts, some adoption claims <p>Claims marked as Inferred should be validated before building production tooling.</p>"},{"location":"spec/appendix/#appendix-a-comparison-of-key-differences","title":"Appendix A: Comparison of Key Differences","text":"Aspect Claude Code Cursor Manifest location <code>.claude-plugin/plugin.json</code> <code>.cursor-plugin/plugin.json</code> Rule format <code>CLAUDE.md</code> (freeform) <code>.mdc</code> / <code>RULE.md</code> (YAML frontmatter) Rule scoping File-based hierarchy <code>globs</code>, <code>alwaysApply</code>, agent-decided Hook config <code>hooks/hooks.json</code> <code>.cursor/hooks.json</code> Hook events <code>PreToolUse</code>, <code>PostToolUse</code>, <code>Stop</code>... <code>beforeShellCommand</code>, <code>afterFileEdit</code>, <code>stop</code>... Skill standard agentskills.io (creator) agentskills.io (adopter, v2.2+) Commands Native <code>commands/</code> dir Via rules or skills Sub-agents Native <code>agents/</code> dir Via rules or imported Team rules N/A (org-wide via API) Dashboard-managed (Team/Enterprise) Distribution <code>/plugin marketplace</code>, npm, git Plugin marketplace, git Root variable <code>${CLAUDE_PLUGIN_ROOT}</code> Working directory relative MCP config (plugin) <code>.mcp.json</code> (leading dot) <code>mcp.json</code> (no dot) MCP config (project) <code>.mcp.json</code> <code>.cursor/mcp.json</code> MCP config (global) <code>~/.claude/.mcp.json</code> <code>~/.cursor/mcp.json</code> Instruction files <code>CLAUDE.md</code> <code>AGENTS.md</code>, <code>CLAUDE.md</code>, <code>GEMINI.md</code> Dependency resolution N/A (no native resolver) N/A (no native resolver) System dep checks Via skill <code>compatibility</code> field N/A Lock file N/A N/A <p>This specification is a living document. Contributions welcome at github.com/spazyCZ/agent-package-manager.</p>"},{"location":"spec/full/","title":"UAAPS \u2014 Full Specification","text":"<p>This page contains the complete specification as a single document, suitable for reading end-to-end or searching across all sections at once.</p>"},{"location":"spec/full/#universal-agentic-artifact-package-specification-uaaps","title":"Universal Agentic Artifact Package Specification (UAAPS)","text":"<p>Version: 0.5.0-draft Date: 2026-02-22 (revised) Purpose: Define a universal, portable package standard for AI agent artifacts \u2014 analogous to Docker for containers or npm for JavaScript packages. Goal: Write once, deploy to any agent platform. Simplify migration. Eliminate vendor lock-in.</p>"},{"location":"spec/full/#1-design-principles","title":"1. Design Principles","text":"Principle Description Portability A single package works across Claude Code, Cursor, Copilot, Codex, and any compliant platform. Progressive Disclosure Metadata loads first; full instructions load on activation; resources load on-demand. Convention over Configuration Standard directory names eliminate per-platform mapping; overrides are optional. Filesystem-First All artifacts are files on disk \u2014 no databases, no APIs required, no binary formats. Composability Packages can be installed together; namespacing prevents conflicts. Deterministic Resolution Lock files ensure reproducible installs across machines and CI. Backward Compatibility Existing Claude Code plugins and Cursor plugins work with minimal changes."},{"location":"spec/full/#2-package-directory-structure","title":"2. Package Directory Structure","text":"<pre><code>package-name/\n\u251c\u2500\u2500 package.agent.json            # Package manifest (REQUIRED)\n\u251c\u2500\u2500 package.agent.lock            # Dependency lock file (auto-generated)\n\u251c\u2500\u2500 skills/                       # Agent Skills (optional)\n\u2502   \u2514\u2500\u2500 skill-name/\n\u2502       \u251c\u2500\u2500 SKILL.md              # Skill instructions (REQUIRED per skill)\n\u2502       \u251c\u2500\u2500 scripts/              # Executable scripts\n\u2502       \u251c\u2500\u2500 references/           # Documentation files\n\u2502       \u2514\u2500\u2500 assets/               # Templates, data, images\n\u251c\u2500\u2500 commands/                     # Slash commands (optional)\n\u2502   \u2514\u2500\u2500 command-name.md\n\u251c\u2500\u2500 agents/                       # Sub-agent definitions (optional)\n\u2502   \u2514\u2500\u2500 agent-name/\n\u2502       \u251c\u2500\u2500 agent.yaml            # Agent definition (name, skills, tools, params)\n\u2502       \u2514\u2500\u2500 system-prompt.md      # Agent system prompt\n\u251c\u2500\u2500 rules/                        # Project rules / instructions (optional)\n\u2502   \u2514\u2500\u2500 rule-name/\n\u2502       \u2514\u2500\u2500 RULE.md\n\u251c\u2500\u2500 hooks/                        # Lifecycle hooks (optional)\n\u2502   \u2514\u2500\u2500 hooks.json\n\u251c\u2500\u2500 mcp/                          # MCP server configs (optional)\n\u2502   \u2514\u2500\u2500 servers.json\n\u251c\u2500\u2500 evals/                        # LLM-judged evaluations (optional)\n\u2502   \u251c\u2500\u2500 eval-config.json          #   Eval runner configuration\n\u2502   \u251c\u2500\u2500 fixtures/                 #   Shared test fixtures\n\u2502   \u2502   \u2514\u2500\u2500 sample.pdf\n\u2502   \u2514\u2500\u2500 cases/                    #   Eval cases\n\u2502       \u251c\u2500\u2500 01-skill-e2e.yaml     #     Skill end-to-end eval\n\u2502       \u2514\u2500\u2500 02-hook-integration.yaml  # Hook integration eval\n\u251c\u2500\u2500 AGENTS.md                     # Universal agent instructions (optional)\n\u251c\u2500\u2500 README.md                     # Human documentation\n\u251c\u2500\u2500 CHANGELOG.md                  # Version history\n\u2514\u2500\u2500 LICENSE                       # License file\n</code></pre>"},{"location":"spec/full/#tests-vs-evals","title":"Tests vs Evals","text":"Concern <code>tests/</code> (per-artifact) <code>evals/</code> (top-level) Runner <code>assert</code> \u2014 subprocess + check output <code>eval</code> \u2014 LLM-judged in agent sandbox LLM calls 0 2+ per case (execute + judge) Agent needed No Yes \u2014 spawns real agent session Cost Free LLM API cost per case Speed Milliseconds Seconds to minutes CI suitability Every PR Nightly / pre-release What it tests Scripts produce correct output Skill works end-to-end via agent"},{"location":"spec/full/#evals-evals","title":"Evals \u2014 <code>evals/</code>","text":"<p>Evals are LLM-judged integration tests that verify skills and hooks work correctly when executed through a real agent runtime. Each eval case spins up a temporary workspace, launches an agent session, and uses an LLM-as-judge to assess the output.</p>"},{"location":"spec/full/#eval-config-evalseval-configjson","title":"Eval Config \u2014 <code>evals/eval-config.json</code>","text":"<pre><code>{\n  \"version\": 1,\n  \"engine\": \"claude-code\",\n  \"timeout\": 120,\n  \"judge\": \"claude-sonnet\",\n  \"sandbox\": {\n    \"network\": false,\n    \"writable-paths\": [\"src/\", \"output/\"]\n  },\n  \"env\": {\n    \"EVAL_MODE\": \"true\"\n  }\n}\n</code></pre> Field Type Required Description <code>version</code> <code>number</code> Yes Eval config format version. Currently <code>1</code>. <code>engine</code> <code>string</code> Yes Agent runtime to use: <code>\"claude-code\"</code>, <code>\"copilot\"</code>, <code>\"codex\"</code>, <code>\"cursor\"</code>. <code>timeout</code> <code>number</code> No Max seconds per eval case. Default <code>120</code>. <code>judge</code> <code>string</code> No Model used for LLM-as-judge assessment. Default: same as engine model. <code>sandbox.network</code> <code>bool</code> No Allow network access in sandbox. Default <code>false</code>. <code>sandbox.writable-paths</code> <code>string[]</code> No Directories the agent can write to. Default: temp workspace root. <code>env</code> <code>map&lt;str,str&gt;</code> No Environment variables injected into the sandbox."},{"location":"spec/full/#eval-case-format-evalscasesyaml","title":"Eval Case Format \u2014 <code>evals/cases/*.yaml</code>","text":"<pre><code>name: pdf-extraction-e2e\ndescription: Verify pdf-tools skill extracts text via agent session\ntarget: skill:pdf-tools\ninput:\n  prompt: \"Extract all text from fixtures/sample.pdf\"\n  files:\n    - fixtures/sample.pdf\n  workspace-files:\n    - src/empty.txt\nexpected:\n  contains:\n    - \"Hello, World\"\n    - \"Page 1\"\n  not-contains:\n    - \"ERROR\"\n  files-created:\n    - \"output/extracted.txt\"\njudge:\n  criteria: &gt;\n    Output must include all visible text from the PDF.\n    Formatting may differ but content must be complete.\n    The agent must not hallucinate content not in the PDF.\n</code></pre> <pre><code>name: hook-blocks-protected-write\ndescription: Verify pre-tool-use hook blocks agent from writing to /etc\ntarget: hook:pre-tool-use\ninput:\n  prompt: \"Write the word 'test' to /etc/config.txt\"\n  workspace-files:\n    - src/app.ts\nexpected:\n  not-contains:\n    - \"Successfully wrote\"\n  agent-blocked: true\njudge:\n  criteria: &gt;\n    The agent must be blocked by the pre-tool-use hook.\n    The agent should report that the write was denied.\n</code></pre> Field Type Required Description <code>name</code> <code>string</code> Yes Eval case identifier. <code>[a-z0-9-]</code>, max 64 chars. <code>description</code> <code>string</code> No Human-readable description. <code>target</code> <code>string</code> No What is being evaluated: <code>skill:&lt;name&gt;</code>, <code>hook:&lt;event&gt;</code>, or <code>agent:&lt;name&gt;</code>. <code>input.prompt</code> <code>string</code> Yes Prompt sent to the agent. <code>input.files</code> <code>string[]</code> No Fixture files copied into the sandbox (relative to <code>evals/</code>). <code>input.workspace-files</code> <code>string[]</code> No Additional files pre-created in the temp workspace. <code>expected.contains</code> <code>string[]</code> No Substrings that MUST appear in agent output. <code>expected.not-contains</code> <code>string[]</code> No Substrings that MUST NOT appear. <code>expected.files-created</code> <code>string[]</code> No Files the agent must create in the workspace. <code>expected.agent-blocked</code> <code>bool</code> No If <code>true</code>, expects the agent was blocked by a hook. <code>judge.criteria</code> <code>string</code> Yes Natural language pass/fail criteria for the LLM judge."},{"location":"spec/full/#eval-execution-flow","title":"Eval Execution Flow","text":"<pre><code>aam eval pdf-extraction-e2e\n\u2502\n\u251c\u2500 1. Create sandbox\n\u2502     mkdir /tmp/aam-eval-&lt;uuid&gt;/\n\u2502     Copy fixture files + workspace-files\n\u2502     Install package (skills, hooks, rules) into sandbox\n\u2502     Generate minimal package.agent.json\n\u2502\n\u251c\u2500 2. Launch agent session (headless)\n\u2502     claude -p \"&lt;prompt&gt;\" --workspace /tmp/aam-eval-&lt;uuid&gt;/\n\u2502     or: copilot-cli eval --prompt \"&lt;prompt&gt;\" --workspace /tmp/aam-eval-&lt;uuid&gt;/\n\u2502     or: codex --eval \"&lt;prompt&gt;\" --cwd /tmp/aam-eval-&lt;uuid&gt;/\n\u2502\n\u251c\u2500 3. Capture output\n\u2502     Agent stdout, stderr, files created, exit status\n\u2502\n\u251c\u2500 4. Deterministic checks (fast-fail)\n\u2502     contains / not-contains / files-created / agent-blocked\n\u2502\n\u251c\u2500 5. LLM-as-judge\n\u2502     Send output + judge.criteria to judge model\n\u2502     Verdict: PASS | FAIL + reason\n\u2502\n\u2514\u2500 6. Cleanup\n      rm -rf /tmp/aam-eval-&lt;uuid&gt;/\n</code></pre>"},{"location":"spec/full/#platform-eval-entry-points","title":"Platform Eval Entry Points","text":"Engine Headless command Status <code>claude-code</code> <code>claude -p \"prompt\" --workspace &lt;dir&gt;</code> \u2705 Available <code>codex</code> <code>codex --eval \"prompt\" --cwd &lt;dir&gt;</code> \u2705 Available <code>copilot</code> No public headless eval mode \u274c Gap <code>cursor</code> No headless mode \u274c Gap"},{"location":"spec/full/#running-evals","title":"Running Evals","text":"<pre><code>aam eval                              # Run all evals\naam eval pdf-extraction-e2e           # Run a specific eval case\naam eval --engine codex               # Override engine from config\naam eval --judge claude-opus          # Override judge model\naam eval --target skill:pdf-tools     # Run evals targeting a specific skill\naam eval --dry-run                    # Show what would run, no LLM calls\n</code></pre>"},{"location":"spec/full/#eval-report-evalsreportstimestampjson","title":"Eval Report \u2014 <code>evals/reports/&lt;timestamp&gt;.json</code>","text":"<p>Each eval run produces a JSON report capturing full provenance \u2014 which agent, which models, which results. Reports are written to <code>evals/reports/</code> and can be committed for historical tracking.</p> <pre><code>{\n  \"version\": 1,\n  \"id\": \"eval-run-2026-02-22T14-30-00Z\",\n  \"timestamp\": \"2026-02-22T14:30:00Z\",\n  \"duration_seconds\": 87,\n  \"config\": {\n    \"engine\": \"claude-code\",\n    \"engine_version\": \"1.4.2\",\n    \"judge\": \"claude-sonnet-4-20250514\",\n    \"timeout\": 120\n  },\n  \"agent\": {\n    \"runtime\": \"claude-code\",\n    \"runtime_version\": \"1.4.2\",\n    \"model\": \"claude-sonnet-4-20250514\",\n    \"model_provider\": \"anthropic\",\n    \"session_id\": \"sess_abc123\"\n  },\n  \"judge\": {\n    \"model\": \"claude-sonnet-4-20250514\",\n    \"model_provider\": \"anthropic\"\n  },\n  \"environment\": {\n    \"os\": \"linux\",\n    \"arch\": \"x86_64\",\n    \"aam_version\": \"0.5.0\",\n    \"node_version\": \"22.1.0\",\n    \"python_version\": \"3.12.3\"\n  },\n  \"package\": {\n    \"name\": \"@my-org/code-review\",\n    \"version\": \"1.0.0\"\n  },\n  \"summary\": {\n    \"total\": 5,\n    \"passed\": 4,\n    \"failed\": 1,\n    \"skipped\": 0,\n    \"pass_rate\": 0.80\n  },\n  \"cases\": [\n    {\n      \"name\": \"pdf-extraction-e2e\",\n      \"target\": \"skill:pdf-tools\",\n      \"verdict\": \"PASS\",\n      \"duration_seconds\": 18,\n      \"deterministic_checks\": {\n        \"contains\": \"PASS\",\n        \"not_contains\": \"PASS\",\n        \"files_created\": \"PASS\"\n      },\n      \"judge_verdict\": {\n        \"result\": \"PASS\",\n        \"reason\": \"Output contains all visible text from the PDF. No hallucinated content detected.\",\n        \"model\": \"claude-sonnet-4-20250514\"\n      },\n      \"agent_output_snippet\": \"Extracted text from sample.pdf:\\n\\nHello, World\\nPage 1...\"\n    },\n    {\n      \"name\": \"hook-blocks-protected-write\",\n      \"target\": \"hook:pre-tool-use\",\n      \"verdict\": \"FAIL\",\n      \"duration_seconds\": 12,\n      \"deterministic_checks\": {\n        \"not_contains\": \"PASS\",\n        \"agent_blocked\": \"FAIL\"\n      },\n      \"judge_verdict\": {\n        \"result\": \"FAIL\",\n        \"reason\": \"Agent was not blocked \u2014 hook script exited 0 instead of 2.\",\n        \"model\": \"claude-sonnet-4-20250514\"\n      },\n      \"agent_output_snippet\": \"I'll write the file...\",\n      \"error\": \"expected agent-blocked=true but hook exited 0\"\n    }\n  ]\n}\n</code></pre>"},{"location":"spec/full/#report-field-reference","title":"Report Field Reference","text":"Field Type Description <code>id</code> <code>string</code> Unique run identifier. <code>timestamp</code> <code>string</code> ISO 8601 run start time. <code>duration_seconds</code> <code>number</code> Total eval run wall time. <code>config.engine</code> <code>string</code> Agent runtime used (from config or <code>--engine</code> override). <code>config.judge</code> <code>string</code> Judge model used (from config or <code>--judge</code> override). <code>agent.runtime</code> <code>string</code> Actual agent runtime name. <code>agent.runtime_version</code> <code>string</code> Agent runtime version (e.g. Claude Code <code>1.4.2</code>). <code>agent.model</code> <code>string</code> LLM model the agent used for execution. <code>agent.model_provider</code> <code>string</code> Model provider (<code>anthropic</code>, <code>openai</code>, <code>google</code>, etc.). <code>agent.session_id</code> <code>string</code> Agent session ID for traceability. <code>judge.model</code> <code>string</code> LLM model used for judge assessment. <code>judge.model_provider</code> <code>string</code> Judge model provider. <code>environment</code> <code>object</code> OS, architecture, AAM version, language runtimes. <code>package</code> <code>object</code> Package name and version under evaluation. <code>summary</code> <code>object</code> Aggregated pass/fail/skip counts and pass rate. <code>cases[].verdict</code> <code>string</code> <code>\"PASS\"</code>, <code>\"FAIL\"</code>, or <code>\"SKIP\"</code>. <code>cases[].deterministic_checks</code> <code>object</code> Per-check pass/fail for substring and file assertions. <code>cases[].judge_verdict</code> <code>object</code> LLM judge result, reason, and model used. <code>cases[].agent_output_snippet</code> <code>string</code> Truncated agent output (first 500 chars). <code>cases[].error</code> <code>string</code> Error message if the case failed."},{"location":"spec/full/#comparing-eval-reports","title":"Comparing Eval Reports","text":"<pre><code>aam eval --report                     # Generate report (default: evals/reports/&lt;timestamp&gt;.json)\naam eval --report -o report.json      # Custom output path\naam eval diff &lt;report-a&gt; &lt;report-b&gt;   # Compare two reports side by side\n</code></pre> <p>Reports enable tracking eval pass rates across agent versions, model upgrades, and package changes \u2014 answering questions like \"did upgrading from <code>claude-sonnet</code> to <code>claude-opus</code> improve the pdf-tools eval?\"</p>"},{"location":"spec/full/#3-package-manifest-packageagentjson","title":"3. Package Manifest \u2014 <code>package.agent.json</code>","text":"<p>The manifest is the single required file. It identifies the package and declares its contents.</p>"},{"location":"spec/full/#schema","title":"Schema","text":"<pre><code>{\n  // === REQUIRED ===\n  \"name\": \"my-package\",                        // [a-z0-9-] or @scope/name, max 64/130 chars\n  \"version\": \"1.0.0\",                          // SemVer\n\n  // === RECOMMENDED ===\n  \"description\": \"Brief description\",          // Max 1024 chars\n  \"author\": \"org-or-user\",\n  \"license\": \"Apache-2.0\",\n  \"repository\": \"https://github.com/org/repo\",\n  \"homepage\": \"https://docs.example.com\",      // Project homepage or docs URL\n\n  // === OPTIONAL ===\n  \"category\": \"Developer Tools\",               // Marketplace category\n  \"keywords\": [\"testing\", \"python\"],            // Discovery tags\n  \"engines\": {                                  // Platform compatibility\n    \"claude-code\": \"&gt;=1.0\",\n    \"cursor\": \"&gt;=2.2\",\n    \"copilot\": \"*\",\n    \"codex\": \"*\"\n  },\n\n  // === ARTIFACT DECLARATIONS (optional, explicit registry; auto-discovered if omitted) ===\n  // Declaring artifacts explicitly enables richer registry metadata and description per artifact.\n  \"artifacts\": {\n    \"skills\": [\n      { \"name\": \"pdf-tools\", \"path\": \"skills/pdf-tools/\", \"description\": \"Extract text from PDFs\" }\n    ],\n    \"agents\": [\n      { \"name\": \"code-auditor\", \"path\": \"agents/code-auditor/\", \"description\": \"Security audit agent\" }\n    ],\n    \"commands\": [\n      { \"name\": \"review\", \"path\": \"commands/review.md\", \"description\": \"Code review command\" },\n      { \"name\": \"audit-finding\", \"path\": \"commands/audit-finding.md\", \"description\": \"Finding template\" }\n    ]\n  },\n\n  // === DEPENDENCIES (optional) ===\n  \"dependencies\": {                             // Other agent packages required\n    \"code-review\": \"^1.0.0\",                   //   SemVer range\n    \"testing-utils\": \"&gt;=2.1.0 &lt;3.0.0\"\n  },\n  \"optionalDependencies\": {                     // Nice-to-have, install doesn't fail\n    \"ai-image-gen\": \"^1.0.0\"\n  },\n  \"peerDependencies\": {                         // Must be provided by host environment\n    \"eslint-rules\": \"&gt;=3.0.0\"\n  },\n  \"systemDependencies\": {                       // OS-level / runtime requirements\n    \"python\": \"&gt;=3.10\",\n    \"node\": \"&gt;=18\",\n    \"packages\": {                               //   Package manager installs\n      \"pip\": [\"pypdf\", \"pdfplumber&gt;=0.10\"],\n      \"npm\": [\"prettier\", \"eslint\"],\n      \"brew\": [\"graphviz\"],\n      \"apt\": [\"poppler-utils\"]\n    },\n    \"binaries\": [\"git\", \"docker\"],              //   Must exist on $PATH\n    \"mcp-servers\": [\"filesystem\"]              //   Required MCP servers\n  },\n\n  // === ENVIRONMENT &amp; SECRETS (optional) ===\n  \"env\": {                                      // Required environment variables\n    \"GITHUB_TOKEN\": { \"description\": \"Required for PR creation\", \"required\": true },\n    \"DEBUG_MODE\": { \"description\": \"Enable verbose logging\", \"required\": false, \"default\": \"false\" }\n  },\n\n  // === PERMISSIONS (optional) ===\n  \"permissions\": {                              // Requested agent capabilities\n    \"fs\": [\"read\", \"write\"],                    // Filesystem access scope\n    \"network\": [\"api.github.com\"],              // Allowed network hosts\n    \"shell\": false                              // Allow arbitrary shell execution\n  },\n\n  // === QUALITY (optional) ===\n  \"quality\": {\n    \"tests\": [\n      { \"name\": \"unit-tests\", \"command\": \"pytest tests/\", \"description\": \"Unit tests\" }\n    ],\n    \"evals\": [\n      {\n        \"name\": \"accuracy-eval\",\n        \"path\": \"evals/accuracy.yaml\",\n        \"description\": \"Measures accuracy against benchmark\",\n        \"metrics\": [\n          { \"name\": \"accuracy\", \"type\": \"percentage\" }\n        ]\n      }\n    ]\n  },\n\n  // === COMPONENT OVERRIDES (optional, defaults use convention) ===\n  \"skills\": \"./skills\",                         // Default: ./skills\n  \"commands\": \"./commands\",                     // Default: ./commands\n  \"agents\": \"./agents\",                         // Default: ./agents\n  \"rules\": \"./rules\",                           // Default: ./rules\n  \"hooks\": \"./hooks/hooks.json\",                // Default: ./hooks/hooks.json\n  \"mcp\": \"./mcp/servers.json\",                  // Default: ./mcp/servers.json\n\n  // === VENDOR EXTENSIONS (optional) ===\n  \"x-claude\": {\n    \"marketplace\": \"anthropics/skills\"\n  },\n  \"x-cursor\": {\n    \"category\": \"Developer Tools\"\n  }\n}\n</code></pre>"},{"location":"spec/full/#format-support","title":"Format Support","text":"<p>The canonical format is JSON (<code>package.agent.json</code>), but tools SHOULD also accept YAML (<code>package.agent.yaml</code>) for author convenience:</p> <pre><code># package.agent.yaml (equivalent to JSON, author-friendly)\nname: my-package           # or @scope/my-package for scoped\nversion: 1.0.0\ndescription: Brief description\nauthor: org-or-user\nlicense: Apache-2.0\nhomepage: https://docs.example.com\n\nskills: ./skills\ncommands: ./commands\nagents: ./agents\n\ndependencies:\n  code-review: \"^1.0.0\"\n\nx-claude:\n  marketplace: anthropics/skills\n\nx-cursor:\n  category: Developer Tools\n</code></pre> <p>Rules: - If both <code>.json</code> and <code>.yaml</code> exist, JSON takes precedence. - CLI tools (<code>aam install</code>, etc.) generate <code>package.agent.json</code> as the canonical output. - Lock files (<code>package.agent.lock</code>) are always JSON.</p>"},{"location":"spec/full/#vendor-mapping","title":"Vendor Mapping","text":"Manifest Field Claude Code (<code>plugin.json</code>) Cursor (<code>.cursor-plugin/plugin.json</code>) <code>name</code> <code>name</code> <code>name</code> <code>version</code> <code>version</code> <code>version</code> <code>description</code> <code>description</code> <code>description</code> <code>homepage</code> N/A N/A <code>skills</code> (auto-discovered in <code>skills/</code>) (auto-discovered in <code>skills/</code>) <code>commands</code> <code>commands</code> N/A (uses rules) <code>agents</code> <code>agents</code> N/A (uses rules/agents) <code>hooks</code> <code>hooks</code> path <code>.cursor/hooks.json</code> <code>mcp</code> <code>mcpServers</code> <code>mcp.json</code> <code>dependencies</code> N/A (no native equivalent) N/A (no native equivalent) <code>systemDependencies</code> Skill <code>compatibility</code> field N/A <code>quality</code> N/A N/A"},{"location":"spec/full/#4-skills-skillmd","title":"4. Skills \u2014 <code>SKILL.md</code>","text":"<p>Skills are the primary portable artifact \u2014 already standardized via the Agent Skills Open Standard (agentskills.io) and adopted by Claude Code, Cursor, Copilot, Codex, and others.</p>"},{"location":"spec/full/#skillmd-format","title":"SKILL.md Format","text":"<pre><code>---\n# === REQUIRED ===\nname: skill-name                    # [a-z0-9-], max 64 chars\ndescription: &gt;                      # Max 1024 chars. WHAT it does + WHEN to use it.\n  Extract text and tables from PDF files, fill forms, merge documents.\n  Use when working with PDF files or when the user mentions PDFs.\n\n# === OPTIONAL (Open Standard) ===\nlicense: Apache-2.0\ncompatibility:                      # Only if skill has special requirements\n  requires:\n    - python&gt;=3.10\n    - pypdf\nmetadata:                           # Arbitrary key-value extensions\n  author: my-org\n  version: \"1.0\"\n\n# === OPTIONAL (Platform Extensions) ===\nallowed-tools: Read Grep Glob Bash  # Pre-approved tools (experimental)\ncontext: fork                       # Claude Code: run in isolated sub-agent\nagent: Explore                      # Claude Code: sub-agent config\ndisable-model-invocation: true      # Claude Code: user-only invocation\n---\n\n# Skill Title\n\n## Instructions\nStep-by-step guidance...\n\n## Examples\nConcrete usage examples...\n</code></pre>"},{"location":"spec/full/#frontmatter-field-reference","title":"Frontmatter Field Reference","text":"Field Type Required Standard Description <code>name</code> <code>string</code> Yes agentskills.io <code>[a-z0-9-]</code>, max 64 chars <code>description</code> <code>string</code> Yes agentskills.io What + When. Max 1024 chars. <code>license</code> <code>string</code> No agentskills.io License identifier or filename <code>compatibility</code> <code>map</code> No agentskills.io Environment requirements <code>metadata</code> <code>map&lt;str,str&gt;</code> No agentskills.io Extension key-value pairs <code>allowed-tools</code> <code>string</code> No Extension Space-delimited tool whitelist <code>context</code> <code>string</code> No Claude ext. <code>\"fork\"</code> for isolated execution <code>agent</code> <code>string</code> No Claude ext. Sub-agent config name <code>disable-model-invocation</code> <code>bool</code> No Claude ext. Restrict to user-only invocation"},{"location":"spec/full/#skill-directory","title":"Skill Directory","text":"<pre><code>skill-name/\n\u251c\u2500\u2500 SKILL.md         # REQUIRED\n\u251c\u2500\u2500 scripts/         # Executable code (Python, Bash, JS)\n\u251c\u2500\u2500 references/      # Additional documentation\n\u251c\u2500\u2500 assets/          # Templates, images, data\n\u251c\u2500\u2500 examples/        # Example inputs/outputs\n\u2514\u2500\u2500 tests/           # Skill tests (optional)\n    \u251c\u2500\u2500 test-config.json\n    \u2514\u2500\u2500 cases/\n        \u251c\u2500\u2500 01-basic.yaml\n        \u2514\u2500\u2500 02-edge-cases.yaml\n</code></pre>"},{"location":"spec/full/#progressive-disclosure","title":"Progressive Disclosure","text":"Phase What Loads Token Cost 1. Metadata <code>name</code> + <code>description</code> from all skills ~50 tokens/skill 2. Activation Full <code>SKILL.md</code> body ~2,000\u20135,000 tokens 3. Execution <code>scripts/</code>, <code>references/</code>, <code>assets/</code> on-demand Variable"},{"location":"spec/full/#skills-discovery-precedence","title":"Skills Discovery &amp; Precedence","text":"<p>Skills can exist at multiple scopes. The universal resolver follows this precedence:</p> Scope Location Precedence Namespaced? Managed / Enterprise Admin-deployed Highest No Project <code>./skills/</code> (in package or <code>.claude/skills/</code> or <code>.github/skills/</code>) Overrides personal No Personal <code>~/.claude/skills/</code> or <code>~/.github/skills/</code> or user profile Lowest non-plugin No Plugin / Package <code>&lt;package&gt;/skills/</code> Always namespaced Yes (<code>pkg:skill</code>) <p>Resolution rules: - When project and personal skills share the same <code>name</code>, project wins. - Plugin/package skills are always namespaced (<code>package-name:skill-name</code>) so they never conflict. - Enterprise/managed rules override all other scopes. - Monorepo support: skills in nested subdirectory <code>.claude/skills/</code> or <code>.github/skills/</code> are auto-discovered.</p> <p>Disputed precedence: ChatGPT investigation claimed enterprise &gt; personal &gt; project. Our investigation (verified against community guides) found enterprise &gt; project &gt; personal. The enterprise tier being highest is agreed; the project &gt; personal ordering is confirmed by Claude Code behavior where <code>.claude/skills/</code> in the project overrides <code>~/.claude/skills/</code> for same-named skills.</p>"},{"location":"spec/full/#skill-testing","title":"Skill Testing","text":"<p>Skills MAY include a <code>tests/</code> directory with deterministic test cases that verify scripts behave correctly. These tests use the <code>assert</code> runner \u2014 no LLM calls, no agent sandbox, CI-safe.</p> <p>Eval-based testing (LLM-judged, agent sandbox) lives in the top-level <code>evals/</code> directory. See \u00a7 Evals in the package format spec.</p>"},{"location":"spec/full/#test-config-teststest-configjson","title":"Test Config \u2014 <code>tests/test-config.json</code>","text":"<pre><code>{\n  \"version\": 1,\n  \"timeout\": 30,\n  \"env\": {\n    \"SKILL_TEST\": \"true\"\n  }\n}\n</code></pre> Field Type Required Description <code>version</code> <code>number</code> Yes Test config format version. Currently <code>1</code>. <code>timeout</code> <code>number</code> No Max seconds per test case. Default <code>30</code>. <code>env</code> <code>map&lt;str,str&gt;</code> No Environment variables injected during test runs."},{"location":"spec/full/#test-case-format-testscasesyaml","title":"Test Case Format \u2014 <code>tests/cases/*.yaml</code>","text":"<pre><code>name: basic-pdf-extraction\ndescription: Verify script extracts text from a single-page PDF\ninput:\n  command: \"python scripts/extract.py tests/fixtures/sample.pdf\"\n  stdin: null\n  files:\n    - tests/fixtures/sample.pdf\nexpected:\n  exit-code: 0\n  stdout-contains:\n    - \"Hello, World\"\n    - \"Page 1\"\n  not-contains:\n    - \"ERROR\"\n    - \"Traceback\"\n</code></pre> Field Type Required Description <code>name</code> <code>string</code> Yes Test case identifier. <code>[a-z0-9-]</code>, max 64 chars. <code>description</code> <code>string</code> No Human-readable description of what is tested. <code>input.command</code> <code>string</code> Yes Shell command to execute (relative to skill root). <code>input.stdin</code> <code>string</code> No Data piped to stdin. <code>input.files</code> <code>string[]</code> No Fixture files required (relative to skill root). <code>expected.exit-code</code> <code>number</code> No Expected exit code. Default <code>0</code>. <code>expected.stdout-contains</code> <code>string[]</code> No Substrings that MUST appear in stdout. <code>expected.stderr-contains</code> <code>string[]</code> No Substrings that MUST appear in stderr. <code>expected.not-contains</code> <code>string[]</code> No Substrings that MUST NOT appear in combined output. <code>expected.stdout-json</code> <code>object</code> No JSON structure stdout MUST match (deep partial match)."},{"location":"spec/full/#running-skill-tests","title":"Running Skill Tests","text":"<pre><code>aam test                             # Run all assert tests in current package\naam test skill-name                  # Run tests for a specific skill\naam test skill-name --case 01-basic  # Run a single test case\n</code></pre>"},{"location":"spec/full/#platform-compatibility","title":"Platform Compatibility","text":"Platform Skill Location Status Claude Code <code>~/.claude/skills/</code>, <code>.claude/skills/</code>, plugin <code>skills/</code> \u2705 Full support Cursor Plugin <code>skills/</code>, imported as agent-decided rules \u2705 Supported (v2.2+) GitHub Copilot <code>.github/skills/</code>, <code>.claude/skills/</code> (also supported), user profile \u2705 Supported OpenAI Codex <code>~/.codex/skills/</code>, <code>.agents/skills/</code> \u2705 Supported Amp, Goose, OpenCode, Letta Various paths \u2705 Supported"},{"location":"spec/full/#5-commands-slash-commands-reusable-templates","title":"5. Commands (Slash Commands &amp; Reusable Templates)","text":"<p>Commands are markdown prompt files that serve two roles:</p> <ol> <li>User-invoked \u2014 triggered by typing <code>/command-name</code>.</li> <li>Reusable templates \u2014 referenced by agents and skills via <code>{{variable}}</code> interpolation.</li> </ol> <p>A command with no <code>variables</code> is a simple slash command. A command with <code>variables</code> is a parameterized template that can also be referenced by agents and skills.</p>"},{"location":"spec/full/#simple-command","title":"Simple Command","text":"<pre><code>---\nname: review\ndescription: Run a comprehensive code review on the current file\n---\n\nReview the current file for:\n1. Code organization and structure\n2. Error handling patterns\n3. Performance implications\n4. Security vulnerabilities\n5. Test coverage gaps\n\nProvide specific, actionable feedback with line references.\n</code></pre>"},{"location":"spec/full/#parameterized-command-template","title":"Parameterized Command (Template)","text":"<pre><code>---\nname: audit-finding\ndescription: \"Structured command for documenting a single audit finding\"\nvariables:\n  - name: control_id\n    description: \"Control identifier\"\n    required: true\n  - name: severity\n    description: \"Finding severity level\"\n    required: true\n    enum: [critical, high, medium, low]\n    default: medium\n  - name: evidence\n    description: \"Supporting evidence\"\n    required: false\n    default: \"No evidence provided\"\n---\n\n# Audit Finding: {{control_id}}\n\n## Severity: {{severity}}\n\nAnalyze the following evidence and produce a structured finding:\n\n{{evidence}}\n</code></pre>"},{"location":"spec/full/#frontmatter-fields","title":"Frontmatter Fields","text":"Field Type Required Description <code>name</code> <code>string</code> Yes Identifier, <code>[a-z0-9-]</code>, max 64 chars. <code>description</code> <code>string</code> Recommended Shown in command listings and help. <code>variables</code> <code>Variable[]</code> No Template variables with optional defaults and enums. <p>Each variable in the <code>variables</code> array has:</p> Field Type Required Description <code>name</code> <code>string</code> Yes Variable identifier used in <code>{{name}}</code> interpolation. <code>description</code> <code>string</code> No Human-readable description. <code>required</code> <code>boolean</code> No Whether the variable must be provided. Default: <code>false</code>. <code>enum</code> <code>string[]</code> No Allowed values. <code>default</code> <code>string</code> No Default value when not provided."},{"location":"spec/full/#platform-mapping","title":"Platform Mapping","text":"Platform Native Support Location Invocation Claude Code \u2705 Yes <code>commands/</code> (.md files), <code>.claude/prompts/</code> <code>/plugin:command</code> Cursor \u2705 Prompts / \u26a0\ufe0f Commands via rules <code>.cursor/prompts/</code> No native <code>/command</code> from plugins GitHub Copilot \u2705 Yes <code>.github/prompts/&lt;name&gt;.prompt.md</code> Via prompt picker Codex \u26a0\ufe0f Via skills Skills with <code>disable-model-invocation</code> <code>$skill-name</code>"},{"location":"spec/full/#migration-strategy","title":"Migration Strategy","text":"<p>For platforms without native command support, commands can be converted to skills with <code>disable-model-invocation: true</code> to achieve similar user-initiated behavior.</p>"},{"location":"spec/full/#6-agents-sub-agent-definitions","title":"6. Agents (Sub-agent Definitions)","text":"<p>Agents are specialized personas with domain expertise that can be selected automatically or manually. (Note: This is distinct from <code>AGENTS.md</code>, which provides project-wide instructions).</p> <p>Agents are defined as a directory containing two files, which provides richer structured configuration than a single markdown file.</p>"},{"location":"spec/full/#directory-structure","title":"Directory Structure","text":"<pre><code>agents/\n\u2514\u2500\u2500 code-auditor/\n    \u251c\u2500\u2500 agent.yaml        # REQUIRED \u2014 structured agent definition\n    \u2514\u2500\u2500 system-prompt.md  # REQUIRED \u2014 the agent's full system prompt\n</code></pre>"},{"location":"spec/full/#agentyaml-format","title":"<code>agent.yaml</code> Format","text":"<pre><code>name: code-auditor\ndescription: \"Security-focused code review agent\"\nversion: 1.0.0\n\nsystem_prompt: system-prompt.md    # Path to the system prompt file\n\n# Skills this agent uses (resolved from package or dependencies)\nskills:\n  - pdf-tools                      # from this package\n  - code-review                    # from dependency\n\n# Commands this agent references\ncommands:\n  - audit-finding                  # from this package\n\n# Tool access (platform-dependent)\ntools:\n  - file_read\n  - file_write\n  - shell\n\n# Behavioral parameters\nparameters:\n  temperature: 0.3\n  style: professional\n  output_format: markdown\n</code></pre>"},{"location":"spec/full/#system-promptmd-format","title":"<code>system-prompt.md</code> Format","text":"<pre><code>---\ndescription: Security review specialist for vulnerability analysis\ncapabilities:\n  - OWASP Top 10 detection\n  - Dependency vulnerability scanning\n  - Secret detection\n  - Cryptographic implementation review\n---\n\nYou are a security review specialist. When analyzing code:\n\n1. Check for injection vulnerabilities\n2. Verify authentication patterns\n3. Review cryptographic implementations\n4. Scan for hardcoded secrets\n5. Assess dependency security\n\nProvide severity ratings (Critical/High/Medium/Low) with remediation.\n</code></pre>"},{"location":"spec/full/#agentyaml-field-reference","title":"<code>agent.yaml</code> Field Reference","text":"Field Type Required Description <code>name</code> <code>string</code> Yes Agent identifier. <code>description</code> <code>string</code> Yes Role summary for automatic selection. <code>system_prompt</code> <code>string</code> Yes Relative path to <code>system-prompt.md</code>. <code>skills</code> <code>string[]</code> No Skills this agent activates. <code>commands</code> <code>string[]</code> No Commands (including parameterized templates) this agent uses. <code>tools</code> <code>string[]</code> No Tool whitelist (platform-dependent). <code>parameters</code> <code>map</code> No Behavioral parameters (temperature, style, etc.). <p>Legacy format: A single <code>agent-name.md</code> file (without a separate <code>agent.yaml</code>) is also accepted for backward compatibility. In this case the frontmatter fields from the <code>system-prompt.md</code> table below apply directly to the single file.</p>"},{"location":"spec/full/#platform-mapping_1","title":"Platform Mapping","text":"Platform Native Support Migration Claude Code \u2705 Yes (<code>agents/</code> dir) Direct Cursor \u26a0\ufe0f No native <code>agents/</code> Convert <code>system-prompt.md</code> \u2192 RULE.md with <code>alwaysApply: true</code> GitHub Copilot \u2705 <code>.github/agents/*.agent.md</code> Convert to <code>.agent.md</code> Codex \u26a0\ufe0f Via skills Convert to skill"},{"location":"spec/full/#7-rules-project-rules-instructions","title":"7. Rules (Project Rules / Instructions)","text":"<p>Rules provide persistent context \u2014 coding standards, architecture conventions, and project-specific guidance.</p>"},{"location":"spec/full/#universal-format-rulemd","title":"Universal Format: <code>RULE.md</code>","text":"<pre><code>---\ndescription: \"TypeScript coding standards for this project\"\nglobs: \"src/**/*.{ts,tsx}\"\nalwaysApply: false\n---\n\n# TypeScript Standards\n\n- Use strict mode\n- Prefer `const` over `let`\n- Use early returns\n- Named exports only\n- Co-locate tests as `*.test.ts`\n</code></pre>"},{"location":"spec/full/#frontmatter-fields_1","title":"Frontmatter Fields","text":"Field Type Required Description <code>description</code> <code>string</code> Yes Purpose of rule. Used for agent auto-selection. <code>globs</code> <code>string</code> No File patterns for auto-attachment. <code>alwaysApply</code> <code>boolean</code> No Always include in context. Default: <code>false</code>."},{"location":"spec/full/#platform-mapping_2","title":"Platform Mapping","text":"Platform Native Format Migration Claude Code <code>CLAUDE.md</code> (freeform) Copy content into <code>CLAUDE.md</code> Cursor <code>.mdc</code> / <code>RULE.md</code> in <code>.cursor/rules/</code> Copy to <code>.cursor/rules/</code> Codex <code>AGENTS.md</code> Copy into <code>AGENTS.md</code> sections Universal <code>AGENTS.md</code> (project root) Direct (supported everywhere)"},{"location":"spec/full/#agentsmd-as-universal-fallback","title":"<code>AGENTS.md</code> as Universal Fallback","text":"<p><code>AGENTS.md</code> at the project root is the most portable instruction format \u2014 supported by Claude Code, Cursor, Codex, Copilot, Gemini CLI, Jules, Amp, and others. Every universal package SHOULD include an <code>AGENTS.md</code> for maximum compatibility.</p>"},{"location":"spec/full/#8-hooks-lifecycle-event-handlers","title":"8. Hooks (Lifecycle Event Handlers)","text":"<p>Hooks execute shell commands at specific points in the agent lifecycle. They run outside the context window with zero token overhead.</p>"},{"location":"spec/full/#universal-hooksjson-format","title":"Universal <code>hooks.json</code> Format","text":"<pre><code>{\n  \"version\": 1,\n  \"hooks\": {\n    \"pre-tool-use\": [\n      {\n        \"matcher\": \"Write|Edit\",\n        \"hooks\": [{\n          \"type\": \"command\",\n          \"command\": \"bash ${PACKAGE_ROOT}/hooks/scripts/validate.sh\",\n          \"timeout\": 30\n        }]\n      }\n    ],\n    \"post-tool-use\": [\n      {\n        \"matcher\": \"Write|Edit\",\n        \"hooks\": [{\n          \"type\": \"command\",\n          \"command\": \"npx prettier --write ${file}\"\n        }]\n      }\n    ],\n    \"stop\": [\n      {\n        \"hooks\": [{\n          \"type\": \"prompt\",\n          \"prompt\": \"Check if all tasks are complete. Context: $ARGUMENTS\",\n          \"timeout\": 30\n        }]\n      }\n    ],\n    \"session-start\": [\n      {\n        \"hooks\": [{\n          \"type\": \"command\",\n          \"command\": \"bash ${PACKAGE_ROOT}/hooks/scripts/setup.sh\"\n        }]\n      }\n    ]\n  }\n}\n</code></pre>"},{"location":"spec/full/#unified-hook-events","title":"Unified Hook Events","text":"Universal Event Claude Code Cursor Copilot Can Block? Description <code>pre-tool-use</code> <code>PreToolUse</code> <code>beforeShellCommand</code> / <code>beforeMcpCall</code> <code>preToolUse</code> Yes Before tool execution <code>permission-request</code> <code>PermissionRequest</code> N/A N/A Yes Permission dialog shown <code>post-tool-use</code> <code>PostToolUse</code> <code>afterFileEdit</code> N/A Feedback After tool execution <code>pre-prompt</code> <code>UserPromptSubmit</code> <code>beforeSubmitPrompt</code> <code>userPromptSubmitted</code> Yes / Copilot: logging Before prompt processed <code>session-start</code> <code>SessionStart</code> N/A <code>sessionStart</code> Context inject New session begins <code>session-end</code> <code>SessionEnd</code> N/A <code>sessionEnd</code> Cleanup Session terminates <code>stop</code> <code>Stop</code> <code>stop</code> N/A Yes Agent finishes responding <code>sub-agent-end</code> <code>SubagentStop</code> N/A N/A Yes Sub-agent finishes <code>pre-compact</code> <code>PreCompact</code> N/A N/A No Before context compaction <code>notification</code> <code>Notification</code> N/A N/A No System notification <p>Copilot hook gaps: Copilot currently supports 4 hook events vs Claude Code's 10. The <code>stop</code>, <code>post-tool-use</code>, <code>permission-request</code>, <code>sub-agent-end</code>, <code>pre-compact</code>, and <code>notification</code> events have no Copilot equivalent. Community feature request #1157 tracks parity efforts.</p>"},{"location":"spec/full/#hook-types","title":"Hook Types","text":"Type Description Use Case <code>command</code> Execute a shell command Deterministic rules (lint, format, validate) <code>prompt</code> Query an LLM for context-aware decision Stop/continue decisions, complex validation"},{"location":"spec/full/#blocking-response-schema","title":"Blocking Response Schema","text":"<p>For hooks that support blocking (<code>pre-tool-use</code>, <code>permission-request</code>, <code>pre-prompt</code>, <code>stop</code>):</p> <pre><code>{\n  \"hookSpecificOutput\": {\n    \"hookEventName\": \"pre-tool-use\",\n    \"permissionDecision\": \"allow|deny|ask\",\n    \"permissionDecisionReason\": \"Reason shown to user or agent\",\n    \"updatedInput\": {}\n  }\n}\n</code></pre> <p>For <code>stop</code> / <code>sub-agent-end</code>:</p> <pre><code>{\n  \"decision\": \"block\",\n  \"reason\": \"Tests not yet executed\"\n}\n</code></pre>"},{"location":"spec/full/#exit-code-convention","title":"Exit Code Convention","text":"Code Behavior <code>0</code> Success. JSON on stdout parsed for structured control. <code>2</code> Blocking error. <code>stderr</code> fed back to agent. Other Non-blocking error. Logged only."},{"location":"spec/full/#hook-field-reference","title":"Hook Field Reference","text":"Field Type Required Description <code>matcher</code> <code>string</code> No Regex pattern for filtering by tool name. <code>hooks[].type</code> <code>string</code> Yes <code>\"command\"</code> or <code>\"prompt\"</code>. <code>hooks[].command</code> <code>string</code> For <code>command</code> Shell command. Receives JSON on stdin. <code>hooks[].prompt</code> <code>string</code> For <code>prompt</code> LLM prompt. <code>$ARGUMENTS</code> for input. <code>hooks[].timeout</code> <code>number</code> No Timeout in seconds."},{"location":"spec/full/#hooks-directory","title":"Hooks Directory","text":"<pre><code>hooks/\n\u251c\u2500\u2500 hooks.json           # REQUIRED \u2014 hook definitions\n\u251c\u2500\u2500 scripts/             # Shell scripts referenced by hooks\n\u2502   \u251c\u2500\u2500 validate.sh\n\u2502   \u251c\u2500\u2500 setup.sh\n\u2502   \u2514\u2500\u2500 format.sh\n\u2514\u2500\u2500 tests/               # Hook tests (optional)\n    \u251c\u2500\u2500 test-config.json\n    \u251c\u2500\u2500 fixtures/        # Simulated event payloads\n    \u2502   \u251c\u2500\u2500 pre-tool-use-write.json\n    \u2502   \u2514\u2500\u2500 stop-incomplete.json\n    \u2514\u2500\u2500 cases/\n        \u251c\u2500\u2500 01-pre-tool-block.yaml\n        \u2514\u2500\u2500 02-post-tool-format.yaml\n</code></pre>"},{"location":"spec/full/#hook-testing","title":"Hook Testing","text":"<p>Hooks MAY include a <code>tests/</code> directory with deterministic test cases that verify hook scripts behave correctly for simulated lifecycle events. These tests use the <code>assert</code> runner \u2014 no LLM calls, no agent sandbox, CI-safe.</p> <p>Eval-based testing (LLM-judged, agent sandbox) lives in the top-level <code>evals/</code> directory. See \u00a7 Evals in the package format spec.</p>"},{"location":"spec/full/#test-config-teststest-configjson_1","title":"Test Config \u2014 <code>tests/test-config.json</code>","text":"<pre><code>{\n  \"version\": 1,\n  \"timeout\": 30,\n  \"env\": {\n    \"HOOK_TEST\": \"true\",\n    \"PACKAGE_ROOT\": \".\"\n  }\n}\n</code></pre> Field Type Required Description <code>version</code> <code>number</code> Yes Test config format version. Currently <code>1</code>. <code>timeout</code> <code>number</code> No Max seconds per test case. Default <code>30</code>. <code>env</code> <code>map&lt;str,str&gt;</code> No Environment variables injected during test runs."},{"location":"spec/full/#fixture-payloads-testsfixturesjson","title":"Fixture Payloads \u2014 <code>tests/fixtures/*.json</code>","text":"<p>Fixtures simulate the JSON event that a hook receives on stdin during real execution.</p> <pre><code>{\n  \"hookEventName\": \"pre-tool-use\",\n  \"toolName\": \"Write\",\n  \"toolInput\": {\n    \"file_path\": \"/src/app.ts\",\n    \"content\": \"console.log('hello');\"\n  }\n}\n</code></pre>"},{"location":"spec/full/#test-case-format-testscasesyaml_1","title":"Test Case Format \u2014 <code>tests/cases/*.yaml</code>","text":"<pre><code>name: pre-tool-block-forbidden-path\ndescription: Verify pre-tool-use hook blocks writes to protected directories\nevent: pre-tool-use\nhook-index: 0\ninput:\n  fixture: fixtures/pre-tool-use-write.json\n  overrides:\n    toolInput.file_path: \"/etc/passwd\"\nexpected:\n  exit-code: 2\n  stderr-contains:\n    - \"blocked\"\n    - \"protected path\"\n  stdout-json:\n    hookSpecificOutput:\n      permissionDecision: deny\n</code></pre> <pre><code>name: post-tool-format-success\ndescription: Verify post-tool-use hook runs formatter without error\nevent: post-tool-use\nhook-index: 0\ninput:\n  fixture: fixtures/pre-tool-use-write.json\nexpected:\n  exit-code: 0\n  not-contains:\n    - \"ERROR\"\n</code></pre> Field Type Required Description <code>name</code> <code>string</code> Yes Test case identifier. <code>[a-z0-9-]</code>, max 64 chars. <code>description</code> <code>string</code> No Human-readable description of what is tested. <code>event</code> <code>string</code> Yes Hook event to test (e.g. <code>pre-tool-use</code>, <code>stop</code>). <code>hook-index</code> <code>number</code> No Index of the hook group in the event array. Default <code>0</code>. <code>input.fixture</code> <code>string</code> No Path to a fixture JSON file (relative to <code>tests/</code>). <code>input.overrides</code> <code>map</code> No Dot-path overrides applied on top of the fixture. <code>expected.exit-code</code> <code>number</code> No Expected exit code from the hook script. <code>expected.stderr-contains</code> <code>string[]</code> No Substrings that MUST appear in stderr. <code>expected.stdout-json</code> <code>object</code> No JSON structure that stdout MUST match (deep partial match). <code>expected.not-contains</code> <code>string[]</code> No Substrings that MUST NOT appear in combined output."},{"location":"spec/full/#running-hook-tests","title":"Running Hook Tests","text":"<pre><code>aam test --hooks                          # Run all hook tests in current package\naam test --hooks --case 01-pre-tool-block # Run a single hook test case\naam test --hooks --event pre-tool-use     # Run tests for a specific event only\n</code></pre>"},{"location":"spec/full/#9-mcp-server-configuration","title":"9. MCP Server Configuration","text":"<p>Model Context Protocol servers extend agent capabilities with external tool access.</p>"},{"location":"spec/full/#universal-serversjson-format","title":"Universal <code>servers.json</code> Format","text":"<pre><code>{\n  \"servers\": {\n    \"my-service\": {\n      \"command\": \"node\",\n      \"args\": [\"${PACKAGE_ROOT}/mcp-server/index.js\"],\n      \"env\": {\n        \"API_KEY\": \"${API_KEY}\"\n      }\n    }\n  }\n}\n</code></pre>"},{"location":"spec/full/#platform-mapping_3","title":"Platform Mapping","text":"Platform Plugin Location Project Location Global Location Root Variable Claude Code <code>.mcp.json</code> at plugin root <code>.mcp.json</code> at project root <code>~/.claude/.mcp.json</code> <code>${CLAUDE_PLUGIN_ROOT}</code> Cursor <code>mcp.json</code> at plugin root <code>.cursor/mcp.json</code> <code>~/.cursor/mcp.json</code> Working dir relative Universal <code>mcp/servers.json</code> <code>mcp/servers.json</code> N/A <code>${PACKAGE_ROOT}</code> <p>Critical: Cursor plugin MCP uses <code>mcp.json</code> (no dot prefix, no <code>.cursor/</code> wrapper). Project/global MCP uses <code>.cursor/mcp.json</code>. Claude Code always uses <code>.mcp.json</code> (leading dot).</p>"},{"location":"spec/full/#10-cross-platform-compatibility-matrix","title":"10. Cross-Platform Compatibility Matrix","text":""},{"location":"spec/full/#artifact-support-by-platform","title":"Artifact Support by Platform","text":"Artifact Claude Code Cursor Copilot Codex Standard Confidence Skills (SKILL.md) \u2705 Native \u2705 v2.2+ \u2705 <code>.github/skills/</code> \u2705 CLI+App agentskills.io Official Commands \u2705 Native \u26a0\ufe0f Via rules \u2705 <code>.prompt.md</code> \u26a0\ufe0f Via skills Package-defined Official Agents \u2705 Native (<code>agents/*.md</code>) \u26a0\ufe0f Via rules \u2705 <code>.agent.md</code> \u26a0\ufe0f Via skills Package-defined Official Rules / Instructions \u2705 <code>CLAUDE.md</code> \u2705 <code>.mdc</code>/<code>RULE.md</code> \u2705 <code>.instructions.md</code> \u26a0\ufe0f <code>AGENTS.md</code> Package-defined Official AGENTS.md \u2705 \u2705 \u2705 \u2705 agents.md Official Hooks \u2705 10 events \u2705 5 events \u2705 4 events \u274c Package-defined Official MCP Servers \u2705 Native \u2705 Native \u2705 CCA + VS Code \u26a0\ufe0f Limited MCP Protocol Official"},{"location":"spec/full/#instruction-file-compatibility","title":"Instruction File Compatibility","text":"File Claude Code Cursor Copilot Codex Jules Confidence <code>AGENTS.md</code> \u2705 \u2705 \u2705 \u2705 \u2705 Official <code>CLAUDE.md</code> \u2705 \u2705* \u274c \u274c \u274c Official <code>GEMINI.md</code> \u274c \u2705* \u274c \u274c \u274c Community <code>.cursor/rules/*.mdc</code> \u274c \u2705 \u274c \u274c \u274c Official <code>.github/copilot-instructions.md</code> \u274c \u274c \u2705 \u274c \u274c Official <code>.github/instructions/*.instructions.md</code> \u274c \u274c \u2705 \u274c \u274c Official <code>.github/agents/*.agent.md</code> \u274c \u274c \u2705 \u274c \u274c Official <p>*Cursor reads <code>CLAUDE.md</code> and <code>GEMINI.md</code> as agent-specific instruction files alongside <code>AGENTS.md</code>.</p>"},{"location":"spec/full/#github-copilot-artifact-types","title":"GitHub Copilot Artifact Types","text":"Artifact Location Format Description Repo instructions <code>.github/copilot-instructions.md</code> Plain Markdown Repository-wide guidance Path instructions <code>.github/instructions/*.instructions.md</code> YAML frontmatter (<code>applyTo</code> glob) + Markdown Path-scoped rules Custom agents <code>.github/agents/*.agent.md</code> Markdown Agent definitions (VS Code) Agent instructions <code>AGENTS.md</code> / <code>CLAUDE.md</code> / <code>GEMINI.md</code> Plain Markdown Agent-specific instructions"},{"location":"spec/full/#path-instructions-example","title":"Path Instructions Example","text":"<pre><code>---\napplyTo: \"src/**/*.ts\"\n---\n\n# TypeScript Standards\n- Use strict mode\n- Prefer interfaces over type aliases\n</code></pre>"},{"location":"spec/full/#11-migration-guides","title":"11. Migration Guides","text":""},{"location":"spec/full/#from-claude-code-plugin-universal-package","title":"From Claude Code Plugin \u2192 Universal Package","text":"<pre><code>.claude-plugin/plugin.json    \u2192  package.agent.json\ncommands/*.md                 \u2192  commands/*.md (unchanged)\nagents/*.md                   \u2192  agents/&lt;name&gt;/system-prompt.md + agent.yaml (add structured def)\nskills/*/SKILL.md             \u2192  skills/*/SKILL.md (unchanged)\n.claude/prompts/*.md          \u2192  commands/*.md (add name field to frontmatter)\nhooks/hooks.json              \u2192  hooks/hooks.json (rename events)\n.mcp.json                     \u2192  mcp/servers.json (restructure)\nCLAUDE.md                     \u2192  AGENTS.md (rename)\n</code></pre>"},{"location":"spec/full/#from-cursor-plugin-universal-package","title":"From Cursor Plugin \u2192 Universal Package","text":"<pre><code>.cursor-plugin/plugin.json    \u2192  package.agent.json\nskills/*/SKILL.md             \u2192  skills/*/SKILL.md (unchanged)\n.cursor/prompts/*.md          \u2192  commands/*.md (add name field to frontmatter)\nrules/*.mdc                   \u2192  rules/*/RULE.md (restructure frontmatter)\nmcp.json                      \u2192  mcp/servers.json (restructure)\n.cursor/hooks.json            \u2192  hooks/hooks.json (rename events)\nAGENTS.md                     \u2192  AGENTS.md (unchanged)\n</code></pre>"},{"location":"spec/full/#from-github-copilot-universal-package","title":"From GitHub Copilot \u2192 Universal Package","text":"<pre><code>.github/copilot-instructions.md    \u2192  AGENTS.md (rename + restructure)\n.github/instructions/*.instructions.md  \u2192  rules/*/RULE.md (applyTo \u2192 globs)\n.github/agents/*.agent.md          \u2192  agents/*.md (remove .agent suffix)\nAGENTS.md                          \u2192  AGENTS.md (unchanged)\n</code></pre>"},{"location":"spec/full/#instructionsmd-to-rulemd-frontmatter-mapping","title":"<code>.instructions.md</code> to <code>RULE.md</code> Frontmatter Mapping","text":"<pre><code># Copilot (.instructions.md)        # Universal (RULE.md)\n---                                  ---\napplyTo: \"src/**/*.ts\"              globs: \"src/**/*.ts\"\n---                                  alwaysApply: false\n                                     description: \"TypeScript standards\"\n                                     ---\n</code></pre>"},{"location":"spec/full/#from-mdc-rule-rulemd","title":"From <code>.mdc</code> Rule \u2192 <code>RULE.md</code>","text":"<pre><code># .mdc (Cursor native)                    # RULE.md (Universal)\n---                                        ---\ndescription: React standards               description: React standards\nglobs: src/**/*.tsx                        globs: src/**/*.tsx\nalwaysApply: false                         alwaysApply: false\n---                                        ---\n# Content...                               # Content...\n</code></pre> <p>The formats are functionally identical. Only the file extension changes.</p>"},{"location":"spec/full/#12-packaging-distribution","title":"12. Packaging &amp; Distribution","text":""},{"location":"spec/full/#uaaps-registry","title":"UAAPS Registry","text":"<p>Packages are published to and installed from a UAAPS registry \u2014 an HTTP server implementing the UAAPS registry protocol. The official public registry is <code>registry.agentpkg.io</code>; organizations can self-host a private registry.</p> <pre><code># Install from the default registry\naam install @myorg/code-review\n\n# Install from a private registry\naam install @myorg/code-review --registry https://pkg.myorg.internal/aam\n\n# Publish to a registry\naam pkg publish --registry https://pkg.myorg.internal/aam\n</code></pre> <p>Registry configuration is managed in <code>~/.aam/config.yaml</code> or <code>.aam/config.yaml</code>:</p> <pre><code>registries:\n  default: https://registry.agentpkg.io\n  sources:\n    - name: myorg\n      url: https://pkg.myorg.internal/aam\n</code></pre> <p>Other distribution channels (Git marketplace, npm bridge, direct install, project-bundled) are supported by the <code>aam</code> CLI \u2014 see <code>aam_cli_new.md</code>.</p>"},{"location":"spec/full/#121-archive-distribution-format","title":"12.1 Archive Distribution Format","text":"<p>Packages are distributed as <code>.aam</code> archives (gzipped tar), providing a binary-safe, single-file distribution unit.</p> <pre><code>my-package-1.0.0.aam   # produced by: aam pkg pack\n</code></pre> <p>Archive constraints: - Maximum size: 50 MB - Must contain <code>package.agent.json</code> at root - No symlinks outside the package directory - No absolute paths - SHA-256 checksum stored in <code>package.agent.lock</code> post-install</p>"},{"location":"spec/full/#122-scoped-package-names","title":"12.2 Scoped Package Names","text":"<p>Following npm convention, packages support a <code>@scope/name</code> format for namespacing under an organization or author:</p> Format Example Use Case Unscoped <code>code-review</code> Community / public packages Scoped <code>@myorg/code-review</code> Organization packages <p>Name rules: - Unscoped: <code>[a-z0-9-]</code>, max 64 chars - Scope: <code>@[a-z0-9][a-z0-9_-]{0,63}</code> - Full scoped name: max 130 chars</p> <p>Filesystem mapping \u2014 the <code>@scope/name</code> format is converted using double-hyphen:</p> Package Name Filesystem Name <code>code-review</code> <code>code-review</code> <code>@myorg/code-review</code> <code>myorg--code-review</code> <p>The <code>--</code> separator is reversible and unambiguous because valid name segments cannot start with hyphens.</p>"},{"location":"spec/full/#123-dist-tags","title":"12.3 Dist-Tags","text":"<p>Dist-tags are named aliases for package versions, enabling installs like <code>aam install @org/agent@stable</code> or enterprise gates like <code>bank-approved</code>.</p>"},{"location":"spec/full/#default-tags","title":"Default Tags","text":"Tag Behavior <code>latest</code> Automatically set to the newest published version <code>stable</code> Opt-in; set manually via <code>aam dist-tag add</code>"},{"location":"spec/full/#custom-tags","title":"Custom Tags","text":"<p>Organizations can define arbitrary tags (e.g., <code>staging</code>, <code>bank-approved</code>, <code>qa-passed</code>).</p> <p>Tag rules: - Lowercase alphanumeric + hyphens only - Max 32 characters - Cannot be a valid SemVer string (prevents ambiguity)</p>"},{"location":"spec/full/#manifest-declaration-optional","title":"Manifest Declaration (optional)","text":"<pre><code>// package.agent.json\n{\n  \"name\": \"@myorg/agent\",\n  \"version\": \"1.2.0\",\n  \"dist-tags\": {\n    \"stable\": \"1.1.0\",     // Maintained by publisher\n    \"latest\": \"1.2.0\"\n  }\n}\n</code></pre>"},{"location":"spec/full/#124-portable-bundles","title":"12.4 Portable Bundles","text":"<p>A portable bundle is a self-contained, pre-compiled archive for a specific target platform. It contains artifacts already transformed to the platform's native format \u2014 no install-time resolution needed.</p> <p>Use case: Distributing packages via Slack, email, or air-gapped environments without a registry.</p> <pre><code>aam pkg build --target cursor\n# \u2192 dist/my-package-1.0.0-cursor.bundle.aam\n\naam pkg build --target copilot\n# \u2192 dist/my-package-1.0.0-copilot.bundle.aam\n\naam pkg build --target all\n# \u2192 one bundle per configured platform\n</code></pre> <p>Bundle structure (tar.gz internally):</p> <pre><code>my-package-1.0.0-cursor.bundle.aam\n\u251c\u2500\u2500 bundle.json               # Bundle manifest\n\u251c\u2500\u2500 .cursor/\n\u2502   \u251c\u2500\u2500 skills/...            # Pre-compiled platform artifacts\n\u2502   \u251c\u2500\u2500 rules/...\n\u2502   \u2514\u2500\u2500 commands/...\n\u2514\u2500\u2500 package.agent.json        # Original manifest for reference\n</code></pre> <p><code>bundle.json</code> schema:</p> <pre><code>{\n  \"format\": \"uaaps-bundle\",\n  \"version\": \"1.0\",\n  \"package\": \"@author/my-agent\",\n  \"package_version\": \"1.2.0\",\n  \"target\": \"cursor\",\n  \"built_at\": \"2026-02-19T14:30:00Z\",\n  \"checksum\": \"sha256:...\",\n  \"artifacts\": [\n    { \"type\": \"skill\", \"name\": \"my-skill\", \"path\": \".cursor/skills/author--my-skill/\" },\n    { \"type\": \"agent\", \"name\": \"my-agent\", \"path\": \".cursor/rules/agent-author--my-agent.mdc\" }\n  ]\n}\n</code></pre> <p>Installing from a bundle:</p> <pre><code>aam install ./dist/my-package-1.0.0-cursor.bundle.aam\n# Deploys immediately \u2014 no dependency resolution needed\n</code></pre>"},{"location":"spec/full/#13-dependency-resolution","title":"13. Dependency Resolution","text":"<p>Dependency resolution is a core differentiator of UAAPS over raw vendor plugin systems. Like npm, pip, or Cargo, the package manager must resolve a directed acyclic graph (DAG) of requirements before installation.</p>"},{"location":"spec/full/#131-dependency-types","title":"13.1 Dependency Types","text":"Type Manifest Key Required to Install? Semantics Direct <code>dependencies</code> Yes \u2014 install fails Other agent packages this package requires to function. Optional <code>optionalDependencies</code> No \u2014 install succeeds Enhances functionality if present. Graceful degradation if absent. Peer <code>peerDependencies</code> Yes \u2014 warn/fail Must be provided by the host project or another top-level install. Not auto-installed. System <code>systemDependencies</code> Yes \u2014 pre-flight check OS binaries, language runtimes, pip/npm packages, MCP servers."},{"location":"spec/full/#132-version-constraint-syntax","title":"13.2 Version Constraint Syntax","text":"<p>UAAPS uses SemVer 2.0 with npm-style range operators:</p> Syntax Meaning Example <code>1.2.3</code> Exact version Only <code>1.2.3</code> <code>^1.2.3</code> Compatible with (<code>&gt;=1.2.3 &lt;2.0.0</code>) Minor + patch updates OK <code>~1.2.3</code> Approximately (<code>&gt;=1.2.3 &lt;1.3.0</code>) Patch updates only <code>&gt;=1.2.0</code> Minimum version <code>1.2.0</code> or higher <code>&gt;=1.0.0 &lt;3.0.0</code> Range Between <code>1.0.0</code> and <code>2.x.x</code> <code>*</code> Any version No constraint"},{"location":"spec/full/#133-lock-file-packageagentlock","title":"13.3 Lock File \u2014 <code>package.agent.lock</code>","text":"<p>After resolution, the solver writes a deterministic lock file pinning exact versions:</p> <pre><code>{\n  \"lockVersion\": 1,\n  \"resolved\": {\n    \"code-review\": {\n      \"version\": \"1.3.2\",\n      \"source\": \"marketplace:anthropics/skills\",\n      \"integrity\": \"sha256-abc123...\",\n      \"dependencies\": {\n        \"git-utils\": \"1.0.1\"\n      }\n    },\n    \"testing-utils\": {\n      \"version\": \"2.4.0\",\n      \"source\": \"npm:@agentpkg/testing-utils\",\n      \"integrity\": \"sha256-def456...\"\n    },\n    \"git-utils\": {\n      \"version\": \"1.0.1\",\n      \"source\": \"marketplace:anthropics/skills\",\n      \"integrity\": \"sha256-ghi789...\"\n    }\n  },\n  \"systemChecks\": {\n    \"python\": \"3.12.1\",\n    \"binaries\": {\n      \"git\": \"/usr/bin/git\",\n      \"docker\": \"/usr/local/bin/docker\"\n    },\n    \"pip\": {\n      \"pypdf\": \"4.1.0\",\n      \"pdfplumber\": \"0.11.4\"\n    }\n  }\n}\n</code></pre> <p>Behavior: - If <code>package.agent.lock</code> exists, install uses locked versions (reproducible builds). - <code>aam install</code> reads the lock file; <code>aam update</code> regenerates it. - Lock files SHOULD be committed to version control for deterministic environments.</p>"},{"location":"spec/full/#134-resolution-algorithm","title":"13.4 Resolution Algorithm","text":"<pre><code>1. Parse root package.agent.json\n2. Build initial requirement graph from dependencies + peerDependencies\n3. For each unresolved requirement:\n   a. Fetch available versions from source (marketplace, npm, local)\n   b. Filter by version constraint\n   c. Select highest compatible version (prefer stable over pre-release)\n   d. Recursively resolve transitive dependencies\n4. Detect conflicts:\n   a. If two packages require incompatible versions of the same dependency \u2192 ERROR\n   b. If peerDependency is unmet by root or any ancestor \u2192 WARN (or ERROR if strict)\n5. Flatten dependency tree (hoist where possible, like npm)\n6. Run system dependency pre-flight checks\n7. Write package.agent.lock\n8. Install resolved packages to install directory\n</code></pre>"},{"location":"spec/full/#135-resolution-strategies","title":"13.5 Resolution Strategies","text":"Strategy Flag Behavior Default (none) Highest compatible version per constraint. Locked <code>--frozen</code> Only use versions from lock file. Fail if lock is stale. Minimal <code>--minimal</code> Lowest version satisfying each constraint (CI reproducibility). Latest <code>--latest</code> Ignore constraints, install latest of everything (dangerous). Dry-run <code>--dry-run</code> Resolve and display tree without installing."},{"location":"spec/full/#136-package-dependencies-agent-to-agent","title":"13.6 Package Dependencies (Agent-to-Agent)","text":"<p>Agent packages can depend on other agent packages. This enables composition:</p> <pre><code>// package.agent.json for \"full-stack-review\"\n{\n  \"name\": \"full-stack-review\",\n  \"version\": \"1.0.0\",\n  \"dependencies\": {\n    \"code-review\": \"^1.0.0\",           // Reuse code review skills\n    \"security-scanning\": \"^2.0.0\",     // Reuse security agents\n    \"testing-utils\": \"^1.5.0\"          // Reuse test generation\n  }\n}\n</code></pre> <p>Transitive resolution: If <code>code-review@1.3.2</code> itself depends on <code>git-utils@^1.0.0</code>, the solver installs <code>git-utils</code> automatically.</p> <p>Namespace isolation: Each installed dependency's skills, commands, and agents are namespaced under <code>dependency-name:artifact-name</code> to prevent collisions.</p>"},{"location":"spec/full/#137-system-dependencies","title":"13.7 System Dependencies","text":"<p>System dependencies are not installed by the package manager \u2014 they are verified via pre-flight checks.</p> <pre><code>\"systemDependencies\": {\n  // === Runtime requirements ===\n  \"python\": \"&gt;=3.10\",                  // Check: python3 --version\n  \"node\": \"&gt;=18\",                      // Check: node --version\n\n  // === Package manager installs ===\n  \"packages\": {\n    \"pip\": [\"pypdf&gt;=4.0\", \"pdfplumber\"],\n    \"npm\": [\"prettier@^3.0\", \"eslint\"],\n    \"brew\": [\"graphviz\", \"poppler\"],\n    \"apt\": [\"poppler-utils\", \"tesseract-ocr\"],\n    \"cargo\": [\"ripgrep\"]\n  },\n\n  // === Binary availability ===\n  \"binaries\": [\"git\", \"docker\", \"gh\"],  // Must exist on $PATH\n\n  // === MCP server requirements ===\n  \"mcp-servers\": [\"filesystem\", \"github\"]\n}\n</code></pre>"},{"location":"spec/full/#pre-flight-check-flow","title":"Pre-flight Check Flow","text":"<pre><code>aam install my-package\n  \u2192 Checking system dependencies...\n  \u2713 python 3.12.1 (&gt;=3.10)\n  \u2713 node 20.11.0 (&gt;=18)\n  \u2713 git found at /usr/bin/git\n  \u2717 docker not found on $PATH\n  \u2713 pip: pypdf 4.1.0 installed\n  \u2717 pip: pdfplumber not installed\n\n  \u26a0 Missing system dependencies:\n    \u2022 docker: Install via https://docs.docker.com/get-docker/\n    \u2022 pdfplumber: Run `pip install pdfplumber`\n\n  Install package anyway? [y/N/auto-install]\n</code></pre>"},{"location":"spec/full/#auto-install-behavior","title":"Auto-Install Behavior","text":"Package Manager Auto-install Flag <code>pip</code> \u2705 Supported <code>--install-system-deps</code> <code>npm</code> \u2705 Supported <code>--install-system-deps</code> <code>brew</code> / <code>apt</code> \u26a0\ufe0f Prompt only Requires <code>--install-system-deps --allow-sudo</code> <code>binaries</code> \u274c Never Manual install instructions provided <code>mcp-servers</code> \u2705 Via MCP registry <code>--install-system-deps</code>"},{"location":"spec/full/#138-skill-level-dependencies","title":"13.8 Skill-Level Dependencies","text":"<p>Individual skills can declare their own dependencies in SKILL.md frontmatter, complementing the package-level manifest:</p> <pre><code>---\nname: pdf-processing\ndescription: Extract text and fill forms in PDFs.\ncompatibility:\n  requires:\n    - python&gt;=3.10\n    - pypdf&gt;=4.0\n    - pdfplumber\n  packages:                          # UAAPS extension\n    - code-review/git-utils          # Depends on another skill\n  optional:\n    - tesseract-ocr                  # For OCR, graceful degradation\n---\n</code></pre> <p>Resolution order: 1. Package-level <code>systemDependencies</code> checked first (covers most skills). 2. Skill-level <code>compatibility.requires</code> checked on activation (lazy check). 3. Skill-level <code>compatibility.packages</code> resolved transitively if referencing other skills.</p>"},{"location":"spec/full/#139-conflict-resolution","title":"13.9 Conflict Resolution","text":""},{"location":"spec/full/#version-conflicts","title":"Version Conflicts","text":"<p>When two packages require incompatible versions of the same dependency:</p> <pre><code>my-app\n\u251c\u2500\u2500 code-review@1.3.2\n\u2502   \u2514\u2500\u2500 git-utils@^1.0.0  \u2192  resolves to 1.0.5\n\u2514\u2500\u2500 deployment@2.0.0\n    \u2514\u2500\u2500 git-utils@^2.0.0  \u2192  resolves to 2.1.0   \u2190 CONFLICT\n</code></pre> <p>Resolution strategies:</p> Strategy Behavior When to Use Fail (default) Error, refuse to install Safety-first environments Duplicate Install both versions, isolate namespaces When skills don't share state Override Use <code>resolutions</code> field to force a version When you know compatibility holds Peer promote Lift to <code>peerDependencies</code>, let host decide Library packages"},{"location":"spec/full/#resolution-overrides","title":"Resolution Overrides","text":"<pre><code>// package.agent.json\n{\n  \"resolutions\": {\n    \"git-utils\": \"2.1.0\"              // Force all transitive refs to this version\n  }\n}\n</code></pre>"},{"location":"spec/full/#skill-name-conflicts","title":"Skill Name Conflicts","text":"<p>When two installed packages export skills with the same <code>name</code>:</p> <ul> <li>Skills are namespaced by package: <code>code-review:lint-check</code> vs <code>testing:lint-check</code>.</li> <li>If a skill is referenced without namespace, the closest scope wins (project &gt; personal &gt; plugin).</li> <li>Explicit disambiguation: <code>aam resolve skill lint-check</code> lists all matches.</li> </ul>"},{"location":"spec/full/#1310-dependency-tree-commands","title":"13.10 Dependency Tree Commands","text":"Command Description <code>aam install</code> Install all dependencies from manifest (or lock file). <code>aam install &lt;pkg&gt;</code> Add a package and resolve. <code>aam update</code> Re-resolve all dependencies, update lock file. <code>aam update &lt;pkg&gt;</code> Update a single package within constraints. <code>aam tree</code> Display the full resolved dependency tree. <code>aam tree --depth=1</code> Show only direct dependencies. <code>aam why &lt;pkg&gt;</code> Explain why a package is installed (which parent requires it). <code>aam check</code> Verify all dependencies are installed and compatible. <code>aam check --system</code> Run system dependency pre-flight checks only. <code>aam outdated</code> List packages with newer versions available. <code>aam audit</code> Check dependencies for known security issues. <code>aam dedupe</code> Flatten tree, remove unnecessary duplicates. <code>aam prune</code> Remove installed packages not in the dependency tree."},{"location":"spec/full/#1311-install-directory-layout","title":"13.11 Install Directory Layout","text":"<pre><code>.agent-packages/                       # Install root (analogous to node_modules/)\n\u251c\u2500\u2500 .lock                              # package.agent.lock (symlink or copy)\n\u251c\u2500\u2500 code-review/                       # Installed package\n\u2502   \u251c\u2500\u2500 package.agent.json\n\u2502   \u251c\u2500\u2500 skills/\n\u2502   \u2502   \u2514\u2500\u2500 lint-review/\n\u2502   \u2502       \u2514\u2500\u2500 SKILL.md\n\u2502   \u2514\u2500\u2500 commands/\n\u2502       \u2514\u2500\u2500 review.md\n\u251c\u2500\u2500 testing-utils/                     # Transitive dependency\n\u2502   \u251c\u2500\u2500 package.agent.json\n\u2502   \u2514\u2500\u2500 skills/\n\u2502       \u2514\u2500\u2500 test-gen/\n\u2502           \u2514\u2500\u2500 SKILL.md\n\u2514\u2500\u2500 git-utils/                         # Shared dependency (hoisted)\n    \u251c\u2500\u2500 package.agent.json\n    \u2514\u2500\u2500 skills/\n        \u2514\u2500\u2500 git-diff/\n            \u2514\u2500\u2500 SKILL.md\n</code></pre> <p>Hoisting: Like npm, shared dependencies are hoisted to the top level of <code>.agent-packages/</code> when version-compatible. This reduces duplication and simplifies skill discovery.</p>"},{"location":"spec/full/#1312-dependency-resolution-in-cicd","title":"13.12 Dependency Resolution in CI/CD","text":"<p>For reproducible builds in CI environments:</p> <pre><code># .github/workflows/agent-check.yml\n- name: Install agent packages (frozen)\n  run: aam install --frozen\n\n- name: Verify system dependencies\n  run: aam check --system\n\n- name: Audit for security issues\n  run: aam audit --severity=high\n</code></pre> <p>The <code>--frozen</code> flag ensures CI uses exactly the versions from <code>package.agent.lock</code>, failing if the lock file is out of date.</p>"},{"location":"spec/full/#14-package-signing-verification","title":"14. Package Signing &amp; Verification","text":"<p>AAM supports multiple levels of integrity and authenticity verification for packages.</p>"},{"location":"spec/full/#141-signing-methods","title":"14.1 Signing Methods","text":"Method Description When to Use Checksum SHA-256 hash of archive, always applied Automatic \u2014 all packages Sigstore Keyless, identity-based via OIDC Recommended for public packages GPG Traditional key-based signing Teams with existing GPG infrastructure Registry Attestation Server-side signatures Automated trust for verified registries"},{"location":"spec/full/#142-signing-flow","title":"14.2 Signing Flow","text":"<pre><code>Author                          Registry                         User\n  \u2502  aam pkg publish --sign       \u2502                               \u2502\n  \u251c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u25ba\u2502                               \u2502\n  \u2502  1. Calculate SHA-256         \u2502                               \u2502\n  \u2502  2. Sign with Sigstore / GPG  \u2502  Verify signature             \u2502\n  \u2502  3. Upload archive+signature  \u2502  Store attestation            \u2502\n  \u2502                               \u2502         aam install pkg       \u2502\n  \u2502                               \u2502\u25c4\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2524\n  \u2502                               \u2502  1. Download archive          \u2502\n  \u2502                               \u251c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u25ba\u2502\n  \u2502                               \u2502  2. Verify checksum           \u2502\n  \u2502                               \u2502  3. Verify signature          \u2502\n  \u2502                               \u2502  4. Check trust policy        \u2502\n</code></pre>"},{"location":"spec/full/#143-verification-policy","title":"14.3 Verification Policy","text":"<p>Configure in global <code>~/.aam/config.yaml</code> or project <code>.aam/config.yaml</code>:</p> <pre><code>security:\n  require_checksum: true           # Always enforced (non-configurable)\n  require_signature: false         # Require signed packages\n  trusted_identities:              # Sigstore OIDC identities to trust\n    - \"*@myorg.com\"\n  trusted_keys:                    # GPG key fingerprints to trust\n    - \"ABCD1234...\"\n  on_signature_failure: warn       # warn | error | ignore\n</code></pre>"},{"location":"spec/full/#144-lock-file-integrity","title":"14.4 Lock File Integrity","text":"<p>The <code>package.agent.lock</code> stores SHA-256 hashes for every resolved package. On <code>--frozen</code> install, hashes are re-verified \u2014 any mismatch aborts with an error, preventing supply-chain tampering.</p>"},{"location":"spec/full/#15-governance-policy-gates","title":"15. Governance &amp; Policy Gates","text":"<p>Governance controls who can install what, and provides a tamper-evident record of actions. Policy gates are client-side (no server required); approval workflows require an HTTP registry.</p>"},{"location":"spec/full/#151-client-side-policy-gates","title":"15.1 Client-Side Policy Gates","text":"<p>Configured in <code>config.yaml</code>, enforced by the CLI before any install or publish:</p> <pre><code>governance:\n  install_policy:\n    allowed_scopes: [\"@myorg\", \"@trusted-vendor\"] # only allow these scopes\n    require_signature: true                        # block unsigned packages\n    require_tag: \"stable\"                          # only install tagged versions\n    blocked_packages: [\"@sketchy/*\"]               # glob-matched block list\n  publish_policy:\n    require_signature: true                        # must sign before publishing\n</code></pre> Gate Trigger Effect <code>allowed_scopes</code> <code>aam install</code> Block packages outside listed scopes <code>require_signature</code> <code>aam install</code> Block unsigned packages <code>require_tag</code> <code>aam install</code> Only allow versions with a specific tag <code>blocked_packages</code> <code>aam install</code> Block specific packages (glob patterns) <code>require_signature</code> <code>aam pkg publish</code> Require signing before publish"},{"location":"spec/full/#152-approval-workflows-http-registry","title":"15.2 Approval Workflows (HTTP Registry)","text":"<p>When <code>require_approval: true</code> is set and publishing to an HTTP registry:</p> <ol> <li><code>aam pkg publish</code> \u2192 uploads with <code>approval_status: pending</code></li> <li>Approvers receive notification</li> <li>Approver runs <code>aam approve @org/agent@1.2.0</code></li> <li>Only approved packages appear in search/install</li> </ol>"},{"location":"spec/full/#153-audit-events","title":"15.3 Audit Events","text":"<p>Every registry mutation is logged immutably:</p> Event Description <code>package.publish</code> New version published <code>version.yank</code> Version marked as yanked <code>tag.set</code> Dist-tag added or updated <code>tag.remove</code> Dist-tag removed <code>version.approve</code> Version approved <code>version.reject</code> Version rejected <code>ownership.transfer</code> Package ownership transferred"},{"location":"spec/full/#16-validation-rules","title":"16. Validation Rules","text":"Rule Constraint Package <code>name</code> <code>[a-z0-9-]</code>, max 64 chars Package <code>version</code> Valid SemVer 2.0 Skill <code>description</code> Max 1024 chars, must describe WHAT + WHEN SKILL.md body Recommended &lt; 5,000 tokens / 500 lines Frontmatter Valid YAML, no tabs Scripts Must be self-contained or document dependencies Hook commands Must handle JSON on stdin File references Forward slashes only, relative paths Dependency versions Valid SemVer range syntax (<code>^</code>, <code>~</code>, <code>&gt;=</code>, exact) Dependency graph Must be acyclic \u2014 circular dependencies are an error Peer dependencies Must be satisfied by root or ancestor package System dependencies Pre-flight check must pass (or explicit <code>--skip-checks</code>) Lock file integrity Hash must match on <code>--frozen</code> install Namespace uniqueness No two skills with same <code>name</code> within a single package Resolution overrides <code>resolutions</code> entries must reference packages in the tree"},{"location":"spec/full/#17-security-considerations","title":"17. Security Considerations","text":"<ol> <li>Only install packages from trusted sources \u2014 skills can execute code and access the filesystem.</li> <li>Audit all scripts before enabling \u2014 look for network calls, file access, and unexpected operations.</li> <li>Use <code>allowed-tools</code> to restrict skill capabilities where possible.</li> <li>Hook commands run as the user \u2014 apply least-privilege principles.</li> <li>MCP servers should not expose secrets; use environment variable injection.</li> <li>Environment Variables: Packages must explicitly declare required environment variables in the <code>env</code> manifest field. Host platforms should prompt users securely for these values rather than storing them in plaintext.</li> <li>Permissions Model: Platforms should enforce the <code>permissions</code> manifest field, restricting filesystem, network, and shell access to declared scopes.</li> <li>Sandbox untrusted packages before production deployment.</li> <li>Verify lock file integrity \u2014 <code>package.agent.lock</code> hashes prevent supply-chain tampering.</li> <li>Run <code>aam audit</code> regularly to check dependencies for known vulnerabilities.</li> <li>System dependency auto-install never uses <code>sudo</code> without explicit <code>--allow-sudo</code> flag.</li> <li>Transitive dependencies should be audited \u2014 <code>aam tree</code> reveals the full graph.</li> </ol>"},{"location":"spec/full/#18-glossary","title":"18. Glossary","text":"Term Definition Command A markdown file triggered by user typing <code>/name</code> or referenced as a parameterized template with <code>{{variable}}</code> interpolation. User or agent-invoked. Skill A folder with <code>SKILL.md</code> that teaches an agent a specific capability. Model-invoked. Agent A specialized persona definition with <code>agent.yaml</code> + <code>system-prompt.md</code>. Model or user-invoked. Rule Persistent context (coding standards, conventions). Applied by scope rules. Hook A shell command triggered by a lifecycle event. Always executed, zero token cost. MCP Server An external tool server using the Model Context Protocol. AGENTS.md Universal, freeform instruction file for any agent. Progressive Disclosure Loading strategy: metadata \u2192 instructions \u2192 resources, on-demand. Dependency Another agent package required for this package to function. Peer Dependency A package that must be provided by the host environment, not auto-installed. Optional Dependency A package that enhances functionality but isn't required. System Dependency An OS binary, runtime, or package-manager package required on the host. Lock File <code>package.agent.lock</code> \u2014 pins exact resolved versions for reproducible installs. Hoisting Flattening shared dependencies to the top of the install tree to reduce duplication. Resolution Override A <code>resolutions</code> entry that forces a specific version for a transitive dependency. Pre-flight Check Verification that system dependencies exist before package installation. SemVer Semantic Versioning 2.0 \u2014 <code>MAJOR.MINOR.PATCH</code> with defined compatibility rules. DAG Directed Acyclic Graph \u2014 the dependency tree structure. Cycles are forbidden. Permissions Declared scopes (fs, network, shell) that restrict what a package can do. Env Environment variables and secrets required by the package to function. Scope The <code>@org</code> namespace prefix in <code>@org/package-name</code> for organizational grouping. Archive A <code>.aam</code> gzipped tar file containing a distributable package. Bundle A pre-compiled, platform-specific archive requiring no install-time resolution. Dist-tag A named alias for a specific package version (e.g., <code>stable</code>, <code>bank-approved</code>). Policy Gate A client-side governance rule enforced before install or publish operations."},{"location":"spec/full/#appendix-confidence-legend","title":"Appendix: Confidence Legend","text":"Level Meaning Example Official Verified against vendor documentation Hook event names, manifest schema Community Confirmed by multiple community sources Pseudo-XML rule structure, Cursor RULE.md folders Inferred Derived from behavior or early previews Parallel agent counts, some adoption claims <p>Claims marked as Inferred should be validated before building production tooling.</p>"},{"location":"spec/full/#appendix-a-comparison-of-key-differences","title":"Appendix A: Comparison of Key Differences","text":"Aspect Claude Code Cursor Manifest location <code>.claude-plugin/plugin.json</code> <code>.cursor-plugin/plugin.json</code> Rule format <code>CLAUDE.md</code> (freeform) <code>.mdc</code> / <code>RULE.md</code> (YAML frontmatter) Rule scoping File-based hierarchy <code>globs</code>, <code>alwaysApply</code>, agent-decided Hook config <code>hooks/hooks.json</code> <code>.cursor/hooks.json</code> Hook events <code>PreToolUse</code>, <code>PostToolUse</code>, <code>Stop</code>... <code>beforeShellCommand</code>, <code>afterFileEdit</code>, <code>stop</code>... Skill standard agentskills.io (creator) agentskills.io (adopter, v2.2+) Commands Native <code>commands/</code> dir Via rules or skills Sub-agents Native <code>agents/</code> dir Via rules or imported Team rules N/A (org-wide via API) Dashboard-managed (Team/Enterprise) Distribution <code>/plugin marketplace</code>, npm, git Plugin marketplace, git Root variable <code>${CLAUDE_PLUGIN_ROOT}</code> Working directory relative MCP config (plugin) <code>.mcp.json</code> (leading dot) <code>mcp.json</code> (no dot) MCP config (project) <code>.mcp.json</code> <code>.cursor/mcp.json</code> MCP config (global) <code>~/.claude/.mcp.json</code> <code>~/.cursor/mcp.json</code> Instruction files <code>CLAUDE.md</code> <code>AGENTS.md</code>, <code>CLAUDE.md</code>, <code>GEMINI.md</code> Dependency resolution N/A (no native resolver) N/A (no native resolver) System dep checks Via skill <code>compatibility</code> field N/A Lock file N/A N/A <p>This specification is a living document. Contributions welcome at github.com/spazyCZ/agent-package-manager.</p>"}]}